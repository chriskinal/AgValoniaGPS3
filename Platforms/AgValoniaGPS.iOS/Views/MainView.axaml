<UserControl xmlns="https://github.com/avaloniaui"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
        xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
        xmlns:vm="using:AgValoniaGPS.ViewModels"
        xmlns:controls="using:AgValoniaGPS.Views.Controls"
        mc:Ignorable="d" d:DesignWidth="1194" d:DesignHeight="834"
        x:Class="AgValoniaGPS.iOS.Views.MainView"
        x:DataType="vm:MainViewModel"
        Background="#1a1a1a"
        ClipToBounds="False">

    <UserControl.Styles>
        <!-- Mobile-friendly button style -->
        <Style Selector="Button.MobileButton">
            <Setter Property="Width" Value="60"/>
            <Setter Property="Height" Value="60"/>
            <Setter Property="CornerRadius" Value="12"/>
            <Setter Property="Background" Value="#DD2C3E50"/>
            <Setter Property="BorderThickness" Value="0"/>
            <Setter Property="Padding" Value="0"/>
        </Style>
        <Style Selector="Button.MobileButton:pointerover">
            <Setter Property="Background" Value="#DD3498DB"/>
        </Style>
        <Style Selector="Button.MobileButton:pressed">
            <Setter Property="Background" Value="#DD1ABC9C"/>
        </Style>

        <!-- Small mobile button -->
        <Style Selector="Button.MobileButtonSmall">
            <Setter Property="Width" Value="50"/>
            <Setter Property="Height" Value="50"/>
            <Setter Property="CornerRadius" Value="10"/>
            <Setter Property="Background" Value="#DD2C3E50"/>
            <Setter Property="BorderThickness" Value="0"/>
            <Setter Property="Padding" Value="0"/>
        </Style>
        <Style Selector="Button.MobileButtonSmall:pointerover">
            <Setter Property="Background" Value="#DD3498DB"/>
        </Style>

        <!-- Status panel style -->
        <Style Selector="Border.StatusPanel">
            <Setter Property="Background" Value="#CC1a1a1a"/>
            <Setter Property="CornerRadius" Value="8"/>
            <Setter Property="Padding" Value="12,8"/>
        </Style>
    </UserControl.Styles>

    <!-- Full-screen layout using Panel to avoid clipping -->
    <Panel ClipToBounds="False">
        <!-- FULL SCREEN MAP - Using Avalonia.Labs SKCanvasView -->
        <controls:SkiaMapControlLabs x:Name="MapControl" IsGridVisible="True" />

        <!-- TOP-LEFT: GPS Status -->
        <Border Classes="StatusPanel"
                Margin="20,40,0,0"
                HorizontalAlignment="Left"
                VerticalAlignment="Top">
            <StackPanel Orientation="Horizontal" Spacing="12">
                <Ellipse Width="16" Height="16" Fill="#3498DB"/>
                <TextBlock Text="{Binding FixQuality}" Foreground="White" FontSize="18" FontWeight="Bold" VerticalAlignment="Center"/>
            </StackPanel>
        </Border>

        <!-- TOP-CENTER: Speed Display -->
        <Border Classes="StatusPanel"
                Margin="0,40,0,0"
                HorizontalAlignment="Center"
                VerticalAlignment="Top">
            <StackPanel Orientation="Horizontal" Spacing="8">
                <TextBlock Text="{Binding Speed, StringFormat={}{0:F1}}" Foreground="White" FontSize="32" FontWeight="Bold" VerticalAlignment="Center"/>
                <TextBlock Text="km/h" Foreground="#888" FontSize="16" VerticalAlignment="Bottom" Margin="0,0,0,4"/>
            </StackPanel>
        </Border>

        <!-- TOP-RIGHT: Heading -->
        <Border Classes="StatusPanel"
                Margin="0,40,20,0"
                HorizontalAlignment="Right"
                VerticalAlignment="Top">
            <StackPanel Orientation="Horizontal" Spacing="4">
                <TextBlock Text="{Binding Heading, StringFormat={}{0:F0}}" Foreground="White" FontSize="24" FontWeight="Bold" VerticalAlignment="Center"/>
                <TextBlock Text="Â°" Foreground="#888" FontSize="18" VerticalAlignment="Center"/>
            </StackPanel>
        </Border>

        <!-- LEFT SIDE: Main Navigation (shared control) -->
        <!-- LeftNavigationPanel needs to fill entire screen to avoid clipping sub-panels on iOS -->
        <controls:LeftNavigationPanel x:Name="LeftNavPanel"
                                      HorizontalAlignment="Stretch"
                                      VerticalAlignment="Stretch"
                                      DataContext="{Binding}"/>

        <!-- RIGHT SIDE: View Controls -->
        <StackPanel Orientation="Vertical" Spacing="12"
                    Margin="0,0,20,0"
                    HorizontalAlignment="Right"
                    VerticalAlignment="Center">

            <!-- Zoom In -->
            <Button Classes="MobileButton" Command="{Binding ZoomInCommand}">
                <TextBlock Text="+" FontSize="32" Foreground="White" HorizontalAlignment="Center"/>
            </Button>

            <!-- 2D/3D Toggle -->
            <Button Classes="MobileButton" Command="{Binding Toggle3DModeCommand}">
                <TextBlock Text="3D" FontSize="20" Foreground="White" FontWeight="Bold" HorizontalAlignment="Center"/>
            </Button>

            <!-- Zoom Out -->
            <Button Classes="MobileButton" Command="{Binding ZoomOutCommand}">
                <TextBlock Text="âˆ’" FontSize="32" Foreground="White" HorizontalAlignment="Center"/>
            </Button>
        </StackPanel>

        <!-- BOTTOM: Position Info -->
        <Border Classes="StatusPanel"
                Margin="20,0,20,30"
                HorizontalAlignment="Center"
                VerticalAlignment="Bottom">
            <StackPanel Orientation="Horizontal" Spacing="30">
                <StackPanel Orientation="Horizontal" Spacing="6">
                    <TextBlock Text="E" Foreground="#3498DB" FontSize="16" FontWeight="Bold" VerticalAlignment="Center"/>
                    <TextBlock Text="{Binding Easting, StringFormat={}{0:F1}}" Foreground="White" FontSize="18" VerticalAlignment="Center"/>
                </StackPanel>
                <StackPanel Orientation="Horizontal" Spacing="6">
                    <TextBlock Text="N" Foreground="#E74C3C" FontSize="16" FontWeight="Bold" VerticalAlignment="Center"/>
                    <TextBlock Text="{Binding Northing, StringFormat={}{0:F1}}" Foreground="White" FontSize="18" VerticalAlignment="Center"/>
                </StackPanel>
            </StackPanel>
        </Border>

        <!-- BOTTOM-LEFT: Simulator Controls (for testing) -->
        <Border Classes="StatusPanel"
                Margin="20,0,0,30"
                HorizontalAlignment="Left"
                VerticalAlignment="Bottom"
                IsVisible="{Binding IsSimulatorPanelVisible}">
            <StackPanel Orientation="Horizontal" Spacing="8">
                <Button Classes="MobileButtonSmall" Command="{Binding SimulatorSteerLeftCommand}">
                    <TextBlock Text="â—€" FontSize="20" Foreground="White"/>
                </Button>
                <Button Classes="MobileButtonSmall" Command="{Binding SimulatorSteerRightCommand}">
                    <TextBlock Text="â–¶" FontSize="20" Foreground="White"/>
                </Button>
            </StackPanel>
        </Border>

        <!-- BOTTOM-RIGHT: Quick Actions -->
        <StackPanel Orientation="Horizontal" Spacing="12"
                    Margin="0,0,20,30"
                    HorizontalAlignment="Right"
                    VerticalAlignment="Bottom">

            <!-- Simulator Toggle -->
            <Button Classes="MobileButtonSmall" Command="{Binding ToggleSimulatorPanelCommand}">
                <TextBlock Text="ðŸŽ®" FontSize="20"/>
            </Button>
        </StackPanel>

    </Panel>
</UserControl>
