<UserControl xmlns="https://github.com/avaloniaui"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
        xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
        xmlns:vm="using:AgValoniaGPS.ViewModels"
        mc:Ignorable="d" d:DesignWidth="1366" d:DesignHeight="768"
        x:Class="AgValoniaGPS.iOS.Views.MainView"
        x:DataType="vm:MainViewModel"
        Background="#1a1a1a">

    <UserControl.Styles>
        <!-- Include shared styles -->
        <StyleInclude Source="avares://AgValoniaGPS.Views/Styles/AppStyles.axaml"/>
    </UserControl.Styles>

    <!-- Main Grid with OpenGL as background -->
    <Grid>
        <!-- Map Render Area (fills entire window) with pointer events -->
        <!-- Platform-specific map control is created at runtime in code-behind -->
        <ContentControl x:Name="MapControlContainer" ZIndex="0"
                        PointerPressed="MapOverlay_PointerPressed"
                        PointerMoved="MapOverlay_PointerMoved"
                        PointerReleased="MapOverlay_PointerReleased"
                        PointerWheelChanged="MapOverlay_PointerWheelChanged" />

        <!-- TOP STATUS BAR: RTK Status -->
        <Border Classes="FloatingPanel"
                ZIndex="10"
                Margin="20"
                HorizontalAlignment="Left"
                VerticalAlignment="Top"
                IsHitTestVisible="True">
            <StackPanel Orientation="Horizontal" Spacing="10">
                <TextBlock Text="RTK Status" Foreground="#3498DB" FontSize="14" FontWeight="Bold"/>
                <Ellipse Width="12" Height="12"
                         Fill="{Binding FixQuality, Converter={StaticResource FixQualityToColorConverter}}"/>
                <TextBlock Text="{Binding FixQuality}" Foreground="White" FontSize="14" FontWeight="Bold"/>
            </StackPanel>
        </Border>

        <!-- TOP-RIGHT PANEL: Quick Actions -->
        <Border Classes="FloatingPanel"
                ZIndex="10"
                Margin="20"
                HorizontalAlignment="Right"
                VerticalAlignment="Top"
                IsHitTestVisible="True">
            <StackPanel Spacing="8">
                <!-- GPS Status Button -->
                <Button Width="48" Height="48"
                        CornerRadius="8"
                        Padding="0"
                        BorderThickness="0"
                        Background="#3498DB"
                        ToolTip.Tip="Data I/O Configuration"
                        Command="{Binding ShowDataIODialogCommand}">
                    <TextBlock Text="GPS" FontSize="12" FontWeight="Bold" Foreground="Black"/>
                </Button>

                <Separator Height="1" Background="#444" Margin="4,4"/>
                <Button Classes="IconButton" Content="âš™ï¸" ToolTip.Tip="Settings"/>
                <Button Classes="IconButton" Content="ðŸ“" ToolTip.Tip="Fields" Command="{Binding ShowFieldSelectionDialogCommand}"/>
                <Button Classes="IconButton" Content="ðŸŽ¬" ToolTip.Tip="Toggle 2D/3D View (F3)" Command="{Binding Toggle3DModeCommand}"/>
                <Separator Height="1" Background="#444" Margin="4,4"/>
                <Button Classes="IconButton" Content="+" ToolTip.Tip="Zoom In" Command="{Binding ZoomInCommand}"/>
                <Button Classes="IconButton" Content="-" ToolTip.Tip="Zoom Out" Command="{Binding ZoomOutCommand}"/>
            </StackPanel>
        </Border>

        <!-- LEFT SIDEBAR: Main Navigation Panel (Draggable & Rotatable) -->
        <Canvas>
            <Border x:Name="LeftNavigationPanel"
                    ZIndex="10"
                    Classes="FloatingPanel"
                    Canvas.Left="20" Canvas.Top="100"
                    IsHitTestVisible="True"
                    PointerPressed="LeftPanelBorder_PointerPressed"
                    PointerMoved="LeftPanelBorder_PointerMoved"
                    PointerReleased="LeftPanelBorder_PointerReleased">
                <StackPanel x:Name="LeftPanelStack" Spacing="6" Orientation="Vertical">
                    <!-- Touch Handle: Tap to rotate, Hold to drag -->
                    <Grid Height="40" Margin="0"
                          Background="#DD2C3E50"
                          Cursor="Hand"
                          PointerPressed="LeftPanel_PointerPressed"
                          PointerMoved="LeftPanel_PointerMoved"
                          PointerReleased="LeftPanel_PointerReleased"
                          ToolTip.Tip="Tap to rotate | Hold and drag to move">
                        <StackPanel Orientation="Horizontal" HorizontalAlignment="Center" VerticalAlignment="Center" Spacing="8">
                            <TextBlock Text="â‰¡" Foreground="#AAA" FontSize="20" FontWeight="Bold" IsHitTestVisible="False"/>
                            <TextBlock Text="âŸ²" Foreground="#AAA" FontSize="18" FontWeight="Bold" IsHitTestVisible="False"/>
                        </StackPanel>
                    </Grid>

                    <Separator Classes="LeftPanelSeparator" Margin="0,4,0,4"/>

                    <!-- 0. File/Application Menu -->
                    <Button Classes="LeftPanelButton" ToolTip.Tip="File Menu"
                            Command="{Binding ToggleFileMenuPanelCommand}">
                        <Image Source="/Assets/Icons/fileMenu.png" Stretch="Uniform"/>
                    </Button>

                    <Separator Classes="LeftPanelSeparator"/>

                    <!-- 1. View Settings -->
                    <Button Classes="LeftPanelButton"
                            ToolTip.Tip="View Settings"
                            Command="{Binding ToggleViewSettingsPanelCommand}">
                        <Image Source="/Assets/Icons/NavigationSettings.png" Stretch="Uniform"/>
                    </Button>

                    <!-- 2. Tools -->
                    <Button Classes="LeftPanelButton" ToolTip.Tip="Tools"
                            Command="{Binding ToggleToolsPanelCommand}">
                        <Image Source="/Assets/Icons/SpecialFunctions.png" Stretch="Uniform"/>
                    </Button>

                    <!-- 3. Configuration -->
                    <Button Classes="LeftPanelButton" ToolTip.Tip="Configuration"
                            Command="{Binding ToggleConfigurationPanelCommand}">
                        <Image Source="/Assets/Icons/Settings48.png" Stretch="Uniform"/>
                    </Button>

                    <!-- 4. Job Menu -->
                    <Button Classes="LeftPanelButton" ToolTip.Tip="Job Menu"
                            Command="{Binding ToggleJobMenuPanelCommand}">
                        <Image Source="/Assets/Icons/JobActive.png" Stretch="Uniform"/>
                    </Button>

                    <!-- 5. Field Tools -->
                    <Button Classes="LeftPanelButton" ToolTip.Tip="Field Tools"
                            Command="{Binding ToggleFieldToolsPanelCommand}">
                        <Image Source="/Assets/Icons/FieldTools.png" Stretch="Uniform"/>
                    </Button>

                    <!-- 6. AutoSteer Config -->
                    <Button Classes="LeftPanelButton" ToolTip.Tip="AutoSteer Configuration">
                        <Image Source="/Assets/Icons/AutoSteerConf.png" Stretch="Uniform"/>
                    </Button>

                    <!-- 7. AgIO / Data I/O -->
                    <Button Classes="LeftPanelButton" ToolTip.Tip="Data I/O"
                            Command="{Binding ShowDataIODialogCommand}">
                        <Image Source="/Assets/Icons/AgIO.png" Stretch="Uniform"/>
                    </Button>
                </StackPanel>
            </Border>
        </Canvas>

        <!-- View Settings Panel (floating, toggleable, draggable) -->
        <Canvas>
            <Border x:Name="ViewSettingsPanel"
                    Classes="FloatingPanel"
                    ZIndex="15"
                    Canvas.Left="90" Canvas.Top="200"
                    IsVisible="{Binding IsViewSettingsPanelVisible}"
                    IsHitTestVisible="True"
                    MinWidth="200">
                <StackPanel Spacing="4">
                    <!-- Header with drag handle and close button -->
                    <Grid ColumnDefinitions="Auto,*,Auto"
                          Height="32"
                          Margin="0,0,0,8"
                          Background="#DD2C3E50"
                          Cursor="Hand"
                          PointerPressed="ViewSettingsPanel_PointerPressed"
                          PointerMoved="ViewSettingsPanel_PointerMoved"
                          PointerReleased="ViewSettingsPanel_PointerReleased"
                          ToolTip.Tip="Drag to move">
                        <!-- Drag Handle Icon -->
                        <TextBlock Grid.Column="0"
                                   Text="â‰¡"
                                   Foreground="#AAA"
                                   FontSize="20"
                                   FontWeight="Bold"
                                   VerticalAlignment="Center"
                                   Margin="8,0,8,0"
                                   IsHitTestVisible="False"/>
                        <!-- Title -->
                        <TextBlock Grid.Column="1"
                                   Text="View Settings"
                                   Foreground="White"
                                   FontSize="16"
                                   FontWeight="Bold"
                                   VerticalAlignment="Center"
                                   IsHitTestVisible="False"/>
                        <!-- Close Button -->
                        <Button Grid.Column="2"
                                Content="âœ•"
                                Width="24" Height="24"
                                Padding="0"
                                BorderThickness="0"
                                Background="Transparent"
                                Foreground="#888"
                                FontSize="16"
                                Cursor="Hand"
                                Command="{Binding ToggleViewSettingsPanelCommand}"
                                ToolTip.Tip="Close"
                                Margin="8,0,8,0"/>
                    </Grid>

                    <Separator Height="1" Background="#444" Margin="0,0,0,4"/>

                    <!-- Camera Controls -->
                    <Grid ColumnDefinitions="*,*" RowDefinitions="Auto,Auto">
                        <Button Grid.Row="0" Grid.Column="0" Classes="ModernButton"
                                Content="ðŸŽ¥ Tilt â–¼" Margin="2"
                                Command="{Binding DecreaseCameraPitchCommand}"
                                ToolTip.Tip="Tilt camera down"/>
                        <Button Grid.Row="0" Grid.Column="1" Classes="ModernButton"
                                Content="ðŸŽ¥ Tilt â–²" Margin="2"
                                Command="{Binding IncreaseCameraPitchCommand}"
                                ToolTip.Tip="Tilt camera up"/>
                        <Button Grid.Row="1" Grid.Column="0" Grid.ColumnSpan="2" Classes="ModernButton"
                                Content="ðŸ“ 2D/3D" Margin="2"
                                Command="{Binding Toggle2D3DCommand}"
                                ToolTip.Tip="Toggle 2D/3D view"/>
                    </Grid>

                    <Separator Height="1" Background="#444" Margin="0,4"/>

                    <!-- Display Options -->
                    <Grid ColumnDefinitions="*,*" RowDefinitions="Auto,Auto">
                        <Button Grid.Row="0" Grid.Column="0" Classes="ModernButton"
                                Content="ðŸ§­ North" Margin="2"
                                Command="{Binding ToggleNorthUpCommand}"
                                ToolTip.Tip="North-up/Track-up"/>
                        <Button Grid.Row="0" Grid.Column="1" Classes="ModernButton"
                                Content="âŠž Grid" Margin="2"
                                Command="{Binding ToggleGridCommand}"
                                ToolTip.Tip="Toggle grid"/>
                        <Button Grid.Row="1" Grid.Column="0" Classes="ModernButton"
                                Content="â˜€ï¸ Day/Night" Margin="2"
                                Command="{Binding ToggleDayNightCommand}"
                                ToolTip.Tip="Day/Night mode"/>
                        <TextBlock Grid.Row="1" Grid.Column="1"
                                   Text="ðŸ“¡ 10 Hz" Margin="2" Padding="8"
                                   HorizontalAlignment="Center" VerticalAlignment="Center"
                                   Foreground="White" FontWeight="Bold" FontSize="12"/>
                    </Grid>

                    <Separator Height="1" Background="#444" Margin="0,4"/>

                    <!-- Brightness -->
                    <Grid ColumnDefinitions="*,*">
                        <Button Grid.Column="0" Classes="ModernButton"
                                Content="{Binding BrightnessDisplay, StringFormat='ðŸ’¡ -{0}'}" Margin="2"
                                Command="{Binding DecreaseBrightnessCommand}"
                                ToolTip.Tip="Decrease brightness"/>
                        <Button Grid.Column="1" Classes="ModernButton"
                                Content="ðŸ’¡ +" Margin="2"
                                Command="{Binding IncreaseBrightnessCommand}"
                                ToolTip.Tip="Increase brightness"/>
                    </Grid>
                </StackPanel>
            </Border>
        </Canvas>

        <!-- File Menu Panel (floating, toggleable, draggable) -->
        <Canvas>
            <Border x:Name="FileMenuPanel"
                    Classes="FloatingPanel"
                    ZIndex="15"
                    Canvas.Left="90" Canvas.Top="100"
                    IsVisible="{Binding IsFileMenuPanelVisible}"
                    IsHitTestVisible="True"
                    MinWidth="200">
                <StackPanel Spacing="4">
                    <!-- Header with drag handle and close button -->
                    <Grid ColumnDefinitions="Auto,*,Auto"
                          Height="32"
                          Margin="0,0,0,8"
                          Background="#DD2C3E50"
                          Cursor="Hand"
                          PointerPressed="FileMenuPanel_PointerPressed"
                          PointerMoved="FileMenuPanel_PointerMoved"
                          PointerReleased="FileMenuPanel_PointerReleased"
                          ToolTip.Tip="Drag to move">
                        <!-- Drag Handle Icon -->
                        <TextBlock Grid.Column="0"
                                   Text="â‰¡"
                                   Foreground="#AAA"
                                   FontSize="20"
                                   FontWeight="Bold"
                                   VerticalAlignment="Center"
                                   Margin="8,0,8,0"
                                   IsHitTestVisible="False"/>
                        <!-- Title -->
                        <TextBlock Grid.Column="1"
                                   Text="File Menu"
                                   Foreground="White"
                                   FontSize="16"
                                   FontWeight="Bold"
                                   VerticalAlignment="Center"
                                   IsHitTestVisible="False"/>
                        <!-- Close Button -->
                        <Button Grid.Column="2"
                                Content="âœ•"
                                Width="24" Height="24"
                                Padding="0"
                                BorderThickness="0"
                                Background="Transparent"
                                Foreground="#888"
                                FontSize="16"
                                Cursor="Hand"
                                Command="{Binding ToggleFileMenuPanelCommand}"
                                ToolTip.Tip="Close"
                                Margin="8,0,8,0"/>
                    </Grid>

                <Separator Height="1" Background="#444" Margin="0,0,0,4"/>

                <!-- Profile -->
                <Button Classes="ModernButton" Content="ðŸ“ New Profile" HorizontalAlignment="Stretch" Margin="0,2"/>
                <Button Classes="ModernButton" Content="ðŸ“‚ Load Profile" HorizontalAlignment="Stretch" Margin="0,2"/>

                <Separator Height="1" Background="#444" Margin="0,4"/>

                <!-- Settings -->
                <Button Classes="ModernButton" Content="ðŸŒ Language" HorizontalAlignment="Stretch" Margin="0,2"/>
                <Button Classes="ModernButton" Content="ðŸŽ® Simulator" HorizontalAlignment="Stretch" Margin="0,2"
                        Command="{Binding ToggleSimulatorPanelCommand}"/>
                <Button Classes="ModernButton" Content="ðŸ“ Enter Sim Coords" HorizontalAlignment="Stretch" Margin="0,2"
                        Click="BtnEnterSimCoords_Click"/>

                <Separator Height="1" Background="#444" Margin="0,4"/>

                <!-- Mode & Tools -->
                <Button Classes="ModernButton" Content="ðŸ”’ Kiosk Mode" HorizontalAlignment="Stretch" Margin="0,2"/>
                <Button Classes="ModernButton" Content="ðŸ”„ Reset ALL" HorizontalAlignment="Stretch" Margin="0,2"/>

                <Separator Height="1" Background="#444" Margin="0,4"/>

                <!-- Info & Help -->
                <Button Classes="ModernButton" Content="â„¹ï¸ About" HorizontalAlignment="Stretch" Margin="0,2"/>
                <Button Classes="ModernButton" Content="ðŸŒ AgShare API" HorizontalAlignment="Stretch" Margin="0,2"
                                Click="BtnAgShareSettings_Click"/>
                <Button Classes="ModernButton" Content="â“ Help" HorizontalAlignment="Stretch" Margin="0,2"/>
            </StackPanel>
        </Border>
        </Canvas>

        <!-- Tools Panel (floating, toggleable, draggable) - 2 columns -->
        <Canvas>
            <Border x:Name="ToolsPanel"
                    Classes="FloatingPanel"
                    ZIndex="15"
                    Canvas.Left="90" Canvas.Top="100"
                    IsVisible="{Binding IsToolsPanelVisible}"
                    IsHitTestVisible="True"
                    MinWidth="400">
                <StackPanel Spacing="4">
                    <!-- Header with drag handle and close button -->
                    <Grid ColumnDefinitions="Auto,*,Auto"
                          Height="32"
                          Margin="0,0,0,8"
                          Background="#DD2C3E50"
                          Cursor="Hand"
                          PointerPressed="ToolsPanel_PointerPressed"
                          PointerMoved="ToolsPanel_PointerMoved"
                          PointerReleased="ToolsPanel_PointerReleased"
                          ToolTip.Tip="Drag to move">
                        <!-- Drag Handle Icon -->
                        <TextBlock Grid.Column="0"
                                   Text="â‰¡"
                                   Foreground="#AAA"
                                   FontSize="20"
                                   FontWeight="Bold"
                                   VerticalAlignment="Center"
                                   Margin="8,0,8,0"
                                   IsHitTestVisible="False"/>
                        <!-- Title -->
                        <TextBlock Grid.Column="1"
                                   Text="Tools"
                                   Foreground="White"
                                   FontSize="16"
                                   FontWeight="Bold"
                                   VerticalAlignment="Center"
                                   IsHitTestVisible="False"/>
                        <!-- Close Button -->
                        <Button Grid.Column="2"
                                Content="âœ•"
                                Width="24" Height="24"
                                Padding="0"
                                BorderThickness="0"
                                Background="Transparent"
                                Foreground="#888"
                                FontSize="16"
                                Cursor="Hand"
                                Command="{Binding ToggleToolsPanelCommand}"
                                ToolTip.Tip="Close"
                                Margin="8,0,8,0"/>
                    </Grid>

                    <Separator Height="1" Background="#444" Margin="0,0,0,4"/>

                    <!-- Two Column Layout - 10 items (5 per column) -->
                    <Grid ColumnDefinitions="*,*" RowDefinitions="Auto,Auto,Auto,Auto,Auto" ColumnSpacing="4">
                        <!-- Left Column: Wizards & Charts (5 items) -->
                        <!-- Row 0: Steer Wizard -->
                        <Button Grid.Column="0" Grid.Row="0" Classes="ModernButton" HorizontalAlignment="Stretch" Margin="0,2" Height="44">
                            <StackPanel Orientation="Horizontal" Spacing="6">
                                <Image Source="/Assets/Icons/WizardWand.png" Width="28" Height="28"/>
                                <TextBlock Text="Steer Wizard" VerticalAlignment="Center" FontSize="12" FontWeight="SemiBold"/>
                            </StackPanel>
                        </Button>

                        <!-- Row 1: Steer Chart -->
                        <Button Grid.Column="0" Grid.Row="1" Classes="ModernButton" HorizontalAlignment="Stretch" Margin="0,2" Height="44">
                            <StackPanel Orientation="Horizontal" Spacing="6">
                                <Image Source="/Assets/Icons/AutoSteerOn.png" Width="28" Height="28"/>
                                <TextBlock Text="Steer Chart" VerticalAlignment="Center" FontSize="12"/>
                            </StackPanel>
                        </Button>

                        <!-- Row 2: Heading Chart -->
                        <Button Grid.Column="0" Grid.Row="2" Classes="ModernButton" HorizontalAlignment="Stretch" Margin="0,2" Height="44">
                            <StackPanel Orientation="Horizontal" Spacing="6">
                                <Image Source="/Assets/Icons/ConS_SourcesHeading.png" Width="28" Height="28"/>
                                <TextBlock Text="Heading Chart" VerticalAlignment="Center" FontSize="12"/>
                            </StackPanel>
                        </Button>

                        <!-- Row 3: XTE Chart -->
                        <Button Grid.Column="0" Grid.Row="3" Classes="ModernButton" HorizontalAlignment="Stretch" Margin="0,2" Height="44">
                            <StackPanel Orientation="Horizontal" Spacing="6">
                                <Image Source="/Assets/Icons/AutoManualIsAuto.png" Width="28" Height="28"/>
                                <TextBlock Text="XTE Chart" VerticalAlignment="Center" FontSize="12"/>
                            </StackPanel>
                        </Button>

                        <!-- Row 4: Roll Correction Chart -->
                        <Button Grid.Column="0" Grid.Row="4" Classes="ModernButton" HorizontalAlignment="Stretch" Margin="0,2" Height="44">
                            <StackPanel Orientation="Horizontal" Spacing="6">
                                <Image Source="/Assets/Icons/ConS_SourcesRoll.png" Width="28" Height="28"/>
                                <TextBlock Text="Roll Correction Chart" VerticalAlignment="Center" FontSize="12"/>
                            </StackPanel>
                        </Button>

                        <!-- Right Column: Tools (5 items) -->
                        <!-- Row 0: Boundary Tool -->
                        <Button Grid.Column="1" Grid.Row="0" Classes="ModernButton" HorizontalAlignment="Stretch" Margin="0,2" Height="44">
                            <StackPanel Orientation="Horizontal" Spacing="6">
                                <Image Source="/Assets/Icons/Boundary.png" Width="28" Height="28"/>
                                <TextBlock Text="Boundary Tool" VerticalAlignment="Center" FontSize="12" FontWeight="SemiBold"/>
                            </StackPanel>
                        </Button>

                        <!-- Row 1: Smooth AB Curve -->
                        <Button Grid.Column="1" Grid.Row="1" Classes="ModernButton" HorizontalAlignment="Stretch" Margin="0,2" Height="44">
                            <StackPanel Orientation="Horizontal" Spacing="6">
                                <Image Source="/Assets/Icons/ABSmooth.png" Width="28" Height="28"/>
                                <TextBlock Text="Smooth AB Curve" VerticalAlignment="Center" FontSize="12" FontWeight="SemiBold"/>
                            </StackPanel>
                        </Button>

                        <!-- Row 2: Delete Contour Paths -->
                        <Button Grid.Column="1" Grid.Row="2" Classes="ModernButton" HorizontalAlignment="Stretch" Margin="0,2" Height="44">
                            <StackPanel Orientation="Horizontal" Spacing="6">
                                <Image Source="/Assets/Icons/TrashContourRef.png" Width="28" Height="28"/>
                                <TextBlock Text="Delete Contour Paths" VerticalAlignment="Center" FontSize="12"/>
                            </StackPanel>
                        </Button>

                        <!-- Row 3: Offset Fix -->
                        <Button Grid.Column="1" Grid.Row="3" Classes="ModernButton" HorizontalAlignment="Stretch" Margin="0,2" Height="44">
                            <StackPanel Orientation="Horizontal" Spacing="6">
                                <Image Source="/Assets/Icons/YouTurnReverse.png" Width="28" Height="28"/>
                                <TextBlock Text="Offset Fix" VerticalAlignment="Center" FontSize="12"/>
                            </StackPanel>
                        </Button>

                        <!-- Row 4: Log Viewer -->
                        <Button Grid.Column="1" Grid.Row="4" Classes="ModernButton" HorizontalAlignment="Stretch" Margin="0,2" Height="44">
                            <StackPanel Orientation="Horizontal" Spacing="6">
                                <Image Source="/Assets/Icons/ABTracks.png" Width="28" Height="28"/>
                                <TextBlock Text="Log Viewer" VerticalAlignment="Center" FontSize="12"/>
                            </StackPanel>
                        </Button>
                    </Grid>
                </StackPanel>
            </Border>
        </Canvas>

        <!-- Configuration Panel (floating, toggleable, draggable) - 2 columns -->
        <Canvas>
            <Border x:Name="ConfigurationPanel"
                    Classes="FloatingPanel"
                    ZIndex="15"
                    Canvas.Left="90" Canvas.Top="100"
                    IsVisible="{Binding IsConfigurationPanelVisible}"
                    IsHitTestVisible="True"
                    MinWidth="400">
                <StackPanel Spacing="4">
                    <!-- Header with drag handle and close button -->
                    <Grid ColumnDefinitions="Auto,*,Auto"
                          Height="32"
                          Margin="0,0,0,8"
                          Background="#DD2C3E50"
                          Cursor="Hand"
                          PointerPressed="ConfigurationPanel_PointerPressed"
                          PointerMoved="ConfigurationPanel_PointerMoved"
                          PointerReleased="ConfigurationPanel_PointerReleased"
                          ToolTip.Tip="Drag to move">
                        <!-- Drag Handle Icon -->
                        <TextBlock Grid.Column="0"
                                   Text="â‰¡"
                                   Foreground="#AAA"
                                   FontSize="20"
                                   FontWeight="Bold"
                                   VerticalAlignment="Center"
                                   Margin="8,0,8,0"
                                   IsHitTestVisible="False"/>
                        <!-- Title -->
                        <TextBlock Grid.Column="1"
                                   Text="Configuration"
                                   Foreground="White"
                                   FontSize="16"
                                   FontWeight="Bold"
                                   VerticalAlignment="Center"
                                   IsHitTestVisible="False"/>
                        <!-- Close Button -->
                        <Button Grid.Column="2"
                                Content="âœ•"
                                Width="24" Height="24"
                                Padding="0"
                                BorderThickness="0"
                                Background="Transparent"
                                Foreground="#888"
                                FontSize="16"
                                Cursor="Hand"
                                Command="{Binding ToggleConfigurationPanelCommand}"
                                ToolTip.Tip="Close"
                                Margin="8,0,8,0"/>
                    </Grid>

                    <Separator Height="1" Background="#444" Margin="0,0,0,4"/>

                    <!-- Two Column Layout - 8 items (4 per column) -->
                    <Grid ColumnDefinitions="*,*" RowDefinitions="Auto,Auto,Auto,Auto" ColumnSpacing="4">
                        <!-- Left Column: Main Settings (4 items) -->
                        <!-- Row 0: Configuration -->
                        <Button Grid.Column="0" Grid.Row="0" Classes="ModernButton" HorizontalAlignment="Stretch" Margin="0,2" Height="44">
                            <StackPanel Orientation="Horizontal" Spacing="6">
                                <Image Source="/Assets/Icons/Settings48.png" Width="28" Height="28"/>
                                <TextBlock Text="Configuration" VerticalAlignment="Center" FontSize="12" FontWeight="SemiBold"/>
                            </StackPanel>
                        </Button>

                        <!-- Row 1: Auto Steer -->
                        <Button Grid.Column="0" Grid.Row="1" Classes="ModernButton" HorizontalAlignment="Stretch" Margin="0,2" Height="44">
                            <StackPanel Orientation="Horizontal" Spacing="6">
                                <Image Source="/Assets/Icons/AutoSteerOff.png" Width="28" Height="28"/>
                                <TextBlock Text="Auto Steer" VerticalAlignment="Center" FontSize="12" FontWeight="SemiBold"/>
                            </StackPanel>
                        </Button>

                        <!-- Row 2: View All Settings -->
                        <Button Grid.Column="0" Grid.Row="2" Classes="ModernButton" HorizontalAlignment="Stretch" Margin="0,2" Height="44">
                            <StackPanel Orientation="Horizontal" Spacing="6">
                                <Image Source="/Assets/Icons/ScreenShot.png" Width="28" Height="28"/>
                                <TextBlock Text="View All Settings" VerticalAlignment="Center" FontSize="12"/>
                            </StackPanel>
                        </Button>

                        <!-- Row 3: Directories -->
                        <Button Grid.Column="0" Grid.Row="3" Classes="ModernButton" HorizontalAlignment="Stretch" Margin="0,2" Height="44">
                            <StackPanel Orientation="Horizontal" Spacing="6">
                                <Image Source="/Assets/Icons/FileOpen.png" Width="28" Height="28"/>
                                <TextBlock Text="Directories" VerticalAlignment="Center" FontSize="12"/>
                            </StackPanel>
                        </Button>

                        <!-- Right Column: Data & Appearance (4 items) -->
                        <!-- Row 0: GPS Data -->
                        <Button Grid.Column="1" Grid.Row="0" Classes="ModernButton" HorizontalAlignment="Stretch" Margin="0,2" Height="44">
                            <StackPanel Orientation="Horizontal" Spacing="6">
                                <Image Source="/Assets/Icons/GPSQuality.png" Width="28" Height="28"/>
                                <TextBlock Text="GPS Data" VerticalAlignment="Center" FontSize="12"/>
                            </StackPanel>
                        </Button>

                        <!-- Row 1: Colors -->
                        <Button Grid.Column="1" Grid.Row="1" Classes="ModernButton" HorizontalAlignment="Stretch" Margin="0,2" Height="44">
                            <StackPanel Orientation="Horizontal" Spacing="6">
                                <Image Source="/Assets/Icons/ColourPick.png" Width="28" Height="28"/>
                                <TextBlock Text="Colors" VerticalAlignment="Center" FontSize="12"/>
                            </StackPanel>
                        </Button>

                        <!-- Row 2: Multi-Section Colors -->
                        <Button Grid.Column="1" Grid.Row="2" Classes="ModernButton" HorizontalAlignment="Stretch" Margin="0,2" Height="44">
                            <StackPanel Orientation="Horizontal" Spacing="6">
                                <Image Source="/Assets/Icons/SectionMapping.png" Width="28" Height="28"/>
                                <TextBlock Text="Multi-Section Colors" VerticalAlignment="Center" FontSize="12"/>
                            </StackPanel>
                        </Button>

                        <!-- Row 3: HotKeys -->
                        <Button Grid.Column="1" Grid.Row="3" Classes="ModernButton" HorizontalAlignment="Stretch" Margin="0,2" Height="44">
                            <StackPanel Orientation="Horizontal" Spacing="6">
                                <Image Source="/Assets/Icons/ConD_KeyBoard.png" Width="28" Height="28"/>
                                <TextBlock Text="HotKeys" VerticalAlignment="Center" FontSize="12"/>
                            </StackPanel>
                        </Button>
                    </Grid>
                </StackPanel>
            </Border>
        </Canvas>

        <!-- Job Menu Panel (Button 4) - Start New Field -->
        <Canvas>
            <Border x:Name="JobMenuPanel"
                    Classes="FloatingPanel"
                    ZIndex="15"
                    Canvas.Left="90" Canvas.Top="100"
                    IsVisible="{Binding IsJobMenuPanelVisible}"
                    IsHitTestVisible="True"
                    MinWidth="400">
                <StackPanel Spacing="4">
                    <!-- Header: Drag handle + Title + Close button -->
                    <Grid ColumnDefinitions="Auto,*,Auto" Height="32" Margin="0,0,0,8"
                          Background="#DD2C3E50" Cursor="Hand"
                          PointerPressed="JobMenuPanel_PointerPressed"
                          PointerMoved="JobMenuPanel_PointerMoved"
                          PointerReleased="JobMenuPanel_PointerReleased"
                          ToolTip.Tip="Drag to move">
                        <!-- Drag handle -->
                        <TextBlock Grid.Column="0" Text="â‰¡" FontSize="18" FontWeight="Bold"
                                   Foreground="#FFFFFF" VerticalAlignment="Center" Margin="8,0,0,0"/>
                        <!-- Title -->
                        <TextBlock Grid.Column="1" Text="Start New Field" FontSize="14" FontWeight="SemiBold"
                                   Foreground="#FFFFFF" HorizontalAlignment="Center" VerticalAlignment="Center"/>
                        <!-- Close button -->
                        <Button Grid.Column="2" Content="âœ•" Width="28" Height="28" Margin="0,0,4,0"
                                Background="Transparent" BorderThickness="0" Foreground="#FFFFFF"
                                Command="{Binding ToggleJobMenuPanelCommand}" Cursor="Hand"
                                HorizontalContentAlignment="Center" VerticalContentAlignment="Center"/>
                    </Grid>

                    <Separator Background="#404040" Height="1" Margin="0,0,0,4"/>

                    <!-- Menu Items: 2-column layout (6 rows Ã— 2 columns) -->
                    <Grid ColumnDefinitions="*,*" RowDefinitions="Auto,Auto,Auto,Auto,Auto,Auto" ColumnSpacing="4">
                        <!-- Row 0: ISO-XML, Close -->
                        <Button Grid.Column="0" Grid.Row="0" Classes="ModernButton" HorizontalAlignment="Stretch" Margin="0,2" Height="44"
                                Click="BtnIsoXml_Click">
                            <StackPanel Orientation="Horizontal" Spacing="6">
                                <Image Source="/Assets/Icons/ISOXML.png" Width="28" Height="28"/>
                                <TextBlock Text="ISO-XML" VerticalAlignment="Center" FontSize="12"/>
                            </StackPanel>
                        </Button>
                        <Button Grid.Column="1" Grid.Row="0" Classes="ModernButton" HorizontalAlignment="Stretch" Margin="0,2" Height="44"
                                Click="BtnCloseField_Click"
                                IsEnabled="{Binding IsFieldOpen}">
                            <StackPanel Orientation="Horizontal" Spacing="6">
                                <Image Source="/Assets/Icons/FileClose.png" Width="28" Height="28"/>
                                <TextBlock Text="Close" VerticalAlignment="Center" FontSize="12"/>
                            </StackPanel>
                        </Button>

                        <!-- Row 1: From KML, Drive In -->
                        <Button Grid.Column="0" Grid.Row="1" Classes="ModernButton" HorizontalAlignment="Stretch" Margin="0,2" Height="44"
                                Click="BtnKml_Click">
                            <StackPanel Orientation="Horizontal" Spacing="6">
                                <Image Source="/Assets/Icons/GoogleEarth.png" Width="28" Height="28"/>
                                <TextBlock Text="From KML" VerticalAlignment="Center" FontSize="12"/>
                            </StackPanel>
                        </Button>
                        <Button Grid.Column="1" Grid.Row="1" Classes="ModernButton" HorizontalAlignment="Stretch" Margin="0,2" Height="44"
                                Click="BtnDriveIn_Click">
                            <StackPanel Orientation="Horizontal" Spacing="6">
                                <Image Source="/Assets/Icons/SteerDriveOn.png" Width="28" Height="28"/>
                                <TextBlock Text="Drive In" VerticalAlignment="Center" FontSize="12"/>
                            </StackPanel>
                        </Button>

                        <!-- Row 2: From Existing, Open -->
                        <Button Grid.Column="0" Grid.Row="2" Classes="ModernButton" HorizontalAlignment="Stretch" Margin="0,2" Height="44"
                                Click="BtnFromExisting_Click">
                            <StackPanel Orientation="Horizontal" Spacing="6">
                                <Image Source="/Assets/Icons/FileExisting.png" Width="28" Height="28"/>
                                <TextBlock Text="From Existing" VerticalAlignment="Center" FontSize="12"/>
                            </StackPanel>
                        </Button>
                        <Button Grid.Column="1" Grid.Row="2" Classes="ModernButton" HorizontalAlignment="Stretch" Margin="0,2" Height="44"
                                Click="BtnOpenField_Click">
                            <StackPanel Orientation="Horizontal" Spacing="6">
                                <Image Source="/Assets/Icons/FileOpen.png" Width="28" Height="28"/>
                                <TextBlock Text="Open" VerticalAlignment="Center" FontSize="12"/>
                            </StackPanel>
                        </Button>

                        <!-- Row 3: New From Default, Resume -->
                        <Button Grid.Column="0" Grid.Row="3" Classes="ModernButton" HorizontalAlignment="Stretch" Margin="0,2" Height="44"
                                Click="BtnNewField_Click">
                            <StackPanel Orientation="Horizontal" Spacing="6">
                                <Image Source="/Assets/Icons/FileNew.png" Width="28" Height="28"/>
                                <TextBlock Text="New From Default" VerticalAlignment="Center" FontSize="12"/>
                            </StackPanel>
                        </Button>
                        <Button Grid.Column="1" Grid.Row="3" Classes="ModernButton" HorizontalAlignment="Stretch" Margin="0,2" Height="44"
                                Click="BtnResumeField_Click">
                            <StackPanel Orientation="Horizontal" Spacing="6">
                                <Image Source="/Assets/Icons/FilePrevious.png" Width="28" Height="28"/>
                                <TextBlock Text="Resume" VerticalAlignment="Center" FontSize="12"/>
                            </StackPanel>
                        </Button>

                        <!-- Row 4: AgShare Download, AgShare Upload -->
                        <Button Grid.Column="0" Grid.Row="4" Classes="ModernButton" HorizontalAlignment="Stretch" Margin="0,2" Height="44"
                                Click="BtnAgShareDownload_Click">
                            <StackPanel Orientation="Horizontal" Spacing="6">
                                <Image Source="/Assets/Icons/AgShare.png" Width="28" Height="28"/>
                                <TextBlock Text="AgShare Download" VerticalAlignment="Center" FontSize="12"/>
                            </StackPanel>
                        </Button>
                        <Button Grid.Column="1" Grid.Row="4" Classes="ModernButton" HorizontalAlignment="Stretch" Margin="0,2" Height="44"
                                Click="BtnAgShareUpload_Click">
                            <StackPanel Orientation="Horizontal" Spacing="6">
                                <Image Source="/Assets/Icons/AgShare.png" Width="28" Height="28"/>
                                <TextBlock Text="AgShare Upload" VerticalAlignment="Center" FontSize="12"/>
                            </StackPanel>
                        </Button>

                        <!-- Row 5: Test OSK (temporary for testing) -->
                        <Button Grid.Column="0" Grid.Row="5" Grid.ColumnSpan="2" Classes="ModernButton" HorizontalAlignment="Stretch" Margin="0,2" Height="44"
                                Click="BtnTestOSK_Click">
                            <StackPanel Orientation="Horizontal" Spacing="6">
                                <TextBlock Text="ðŸ”¢" FontSize="24" VerticalAlignment="Center"/>
                                <TextBlock Text="Test Keyboard" VerticalAlignment="Center" FontSize="12"/>
                            </StackPanel>
                        </Button>
                    </Grid>

                    <!-- Current Field Display -->
                    <Border Background="#DD1E8449" CornerRadius="6" Padding="8,4" Margin="0,8,0,0"
                            IsVisible="{Binding IsFieldOpen}">
                        <TextBlock Text="{Binding CurrentFieldName, StringFormat='Current Field: {0}'}"
                                   Foreground="White"
                                   FontSize="13"
                                   FontWeight="SemiBold"
                                   TextWrapping="Wrap"
                                   HorizontalAlignment="Center"/>
                    </Border>
                </StackPanel>
            </Border>
        </Canvas>

        <!-- Field Tools Panel (Button 5) -->
        <Canvas>
            <Border x:Name="FieldToolsPanel"
                    Classes="FloatingPanel"
                    ZIndex="15"
                    Canvas.Left="90" Canvas.Top="100"
                    IsVisible="{Binding IsFieldToolsPanelVisible}"
                    IsHitTestVisible="True"
                    MinWidth="400">
                <StackPanel Spacing="4">
                    <!-- Header: Drag handle + Title + Close button -->
                    <Grid ColumnDefinitions="Auto,*,Auto" Height="32" Margin="0,0,0,8"
                          Background="#DD2C3E50" Cursor="Hand"
                          PointerPressed="FieldToolsPanel_PointerPressed"
                          PointerMoved="FieldToolsPanel_PointerMoved"
                          PointerReleased="FieldToolsPanel_PointerReleased"
                          ToolTip.Tip="Drag to move">
                        <!-- Drag handle -->
                        <TextBlock Grid.Column="0" Text="â‰¡" FontSize="18" FontWeight="Bold"
                                   Foreground="#FFFFFF" VerticalAlignment="Center" Margin="8,0,0,0"/>
                        <!-- Title -->
                        <TextBlock Grid.Column="1" Text="Field Tools" FontSize="14" FontWeight="SemiBold"
                                   Foreground="#FFFFFF" HorizontalAlignment="Center" VerticalAlignment="Center"/>
                        <!-- Close button -->
                        <Button Grid.Column="2" Content="âœ•" Width="28" Height="28" Margin="0,0,4,0"
                                Background="Transparent" BorderThickness="0" Foreground="#FFFFFF"
                                Command="{Binding ToggleFieldToolsPanelCommand}" Cursor="Hand"
                                HorizontalContentAlignment="Center" VerticalContentAlignment="Center"/>
                    </Grid>

                    <Separator Background="#404040" Height="1" Margin="0,0,0,4"/>

                    <!-- Menu Items: 2-column layout (5 rows Ã— 2 columns) -->
                    <Grid ColumnDefinitions="*,*" RowDefinitions="Auto,Auto,Auto,Auto,Auto" ColumnSpacing="4">
                        <!-- Row 0: Boundary, (Blank) -->
                        <Button Grid.Column="0" Grid.Row="0" Classes="ModernButton" HorizontalAlignment="Stretch" Margin="0,2" Height="44"
                                Click="BtnBoundary_Click">
                            <StackPanel Orientation="Horizontal" Spacing="6">
                                <Image Source="/Assets/Icons/Boundary.png" Width="28" Height="28"/>
                                <TextBlock Text="Boundary" VerticalAlignment="Center" FontSize="12"/>
                            </StackPanel>
                        </Button>
                        <!-- Grid.Column="1" Grid.Row="0" is intentionally blank -->

                        <!-- Row 1: Headland, Headland Builder -->
                        <Button Grid.Column="0" Grid.Row="1" Classes="ModernButton" HorizontalAlignment="Stretch" Margin="0,2" Height="44">
                            <StackPanel Orientation="Horizontal" Spacing="6">
                                <Image Source="/Assets/Icons/HeadlandBuild.png" Width="28" Height="28"/>
                                <TextBlock Text="Headland" VerticalAlignment="Center" FontSize="12"/>
                            </StackPanel>
                        </Button>
                        <Button Grid.Column="1" Grid.Row="1" Classes="ModernButton" HorizontalAlignment="Stretch" Margin="0,2" Height="44">
                            <StackPanel Orientation="Horizontal" Spacing="6">
                                <Image Source="/Assets/Icons/Headache.png" Width="28" Height="28"/>
                                <TextBlock Text="Headland Builder" VerticalAlignment="Center" FontSize="12"/>
                            </StackPanel>
                        </Button>

                        <!-- Row 2: Tram Lines, Tram Lines Builder -->
                        <Button Grid.Column="0" Grid.Row="2" Classes="ModernButton" HorizontalAlignment="Stretch" Margin="0,2" Height="44">
                            <StackPanel Orientation="Horizontal" Spacing="6">
                                <Image Source="/Assets/Icons/TramAll.png" Width="28" Height="28"/>
                                <TextBlock Text="Tram Lines" VerticalAlignment="Center" FontSize="12"/>
                            </StackPanel>
                        </Button>
                        <Button Grid.Column="1" Grid.Row="2" Classes="ModernButton" HorizontalAlignment="Stretch" Margin="0,2" Height="44">
                            <StackPanel Orientation="Horizontal" Spacing="6">
                                <Image Source="/Assets/Icons/TramMulti.png" Width="28" Height="28"/>
                                <TextBlock Text="Tram Lines Builder" VerticalAlignment="Center" FontSize="12"/>
                            </StackPanel>
                        </Button>

                        <!-- Row 3: Delete Applied Area, Flag By Lat Lon -->
                        <Button Grid.Column="0" Grid.Row="3" Classes="ModernButton" HorizontalAlignment="Stretch" Margin="0,2" Height="44">
                            <StackPanel Orientation="Horizontal" Spacing="6">
                                <Image Source="/Assets/Icons/TrashApplied.png" Width="28" Height="28"/>
                                <TextBlock Text="Delete Applied Area" VerticalAlignment="Center" FontSize="12"/>
                            </StackPanel>
                        </Button>
                        <Button Grid.Column="1" Grid.Row="3" Classes="ModernButton" HorizontalAlignment="Stretch" Margin="0,2" Height="44">
                            <StackPanel Orientation="Horizontal" Spacing="6">
                                <Image Source="/Assets/Icons/FlagRed.png" Width="28" Height="28"/>
                                <TextBlock Text="Flag By Lat Lon" VerticalAlignment="Center" FontSize="12"/>
                            </StackPanel>
                        </Button>

                        <!-- Row 4: Recorded Path, Import Tracks -->
                        <Button Grid.Column="0" Grid.Row="4" Classes="ModernButton" HorizontalAlignment="Stretch" Margin="0,2" Height="44">
                            <StackPanel Orientation="Horizontal" Spacing="6">
                                <Image Source="/Assets/Icons/RecPath.png" Width="28" Height="28"/>
                                <TextBlock Text="Recorded Path" VerticalAlignment="Center" FontSize="12"/>
                            </StackPanel>
                        </Button>
                        <Button Grid.Column="1" Grid.Row="4" Classes="ModernButton" HorizontalAlignment="Stretch" Margin="0,2" Height="44">
                            <StackPanel Orientation="Horizontal" Spacing="6">
                                <Image Source="/Assets/Icons/BoundaryFromTracks.png" Width="28" Height="28"/>
                                <TextBlock Text="Import Tracks" VerticalAlignment="Center" FontSize="12"/>
                            </StackPanel>
                        </Button>
                    </Grid>
                </StackPanel>
            </Border>
        </Canvas>

        <!-- GPS SIMULATOR PANEL (Draggable) -->
        <Canvas>
            <Border x:Name="SimulatorPanel"
                    Classes="FloatingPanel"
                    ZIndex="15"
                    Canvas.Left="400" Canvas.Top="100"
                    IsVisible="{Binding IsSimulatorPanelVisible}"
                    IsHitTestVisible="True"
                    MinWidth="320">
                <StackPanel Spacing="4">
                    <!-- Header: Drag handle + Title + Close button -->
                    <Grid ColumnDefinitions="*,Auto" Height="32" Margin="0,0,0,8" Background="#DD2C3E50">
                        <!-- Draggable area (drag handle + title) -->
                        <Grid Grid.Column="0" ColumnDefinitions="Auto,*" Cursor="Hand"
                              PointerPressed="SimulatorPanel_PointerPressed"
                              PointerMoved="SimulatorPanel_PointerMoved"
                              PointerReleased="SimulatorPanel_PointerReleased"
                              ToolTip.Tip="Drag to move">
                            <!-- Drag handle -->
                            <TextBlock Grid.Column="0" Text="â‰¡" FontSize="18" FontWeight="Bold"
                                       Foreground="#FFFFFF" VerticalAlignment="Center" Margin="8,0,0,0"/>
                            <!-- Title -->
                            <TextBlock Grid.Column="1" Text="GPS Simulator" FontSize="14" FontWeight="SemiBold"
                                       Foreground="#FFFFFF" HorizontalAlignment="Center" VerticalAlignment="Center"/>
                        </Grid>
                        <!-- Close button (separate from drag area) -->
                        <Button Grid.Column="1" Content="âœ•" Width="28" Height="28" Margin="0,0,4,0"
                                Background="Transparent" BorderThickness="0" Foreground="#FFFFFF"
                                HorizontalContentAlignment="Center" VerticalContentAlignment="Center"
                                Command="{Binding ToggleSimulatorPanelCommand}"
                                Cursor="Hand"
                                ToolTip.Tip="Close panel"/>
                    </Grid>

                    <Separator Background="#555" Height="1"/>

                    <!-- Simulator Controls -->
                    <StackPanel Spacing="8" Margin="12">
                        <!-- Simulator Enable/Disable -->
                        <CheckBox Content="Simulator Enabled"
                                  IsChecked="{Binding IsSimulatorEnabled}"
                                  FontWeight="Bold"
                                  FontSize="13"
                                  Margin="0,0,0,8"/>

                        <!-- Row 1: Reset Position and Reset Steering -->
                        <Grid ColumnDefinitions="*,*">
                            <Button Grid.Column="0" Classes="ModernButton" Margin="0,0,4,0"
                                    Command="{Binding ResetSimulatorCommand}"
                                    ToolTip.Tip="Reset to starting position">
                                <StackPanel Orientation="Horizontal" Spacing="6">
                                    <TextBlock Text="ðŸ”„" FontSize="16"/>
                                    <TextBlock Text="Reset" FontSize="12"/>
                                </StackPanel>
                            </Button>
                            <Button Grid.Column="1" Classes="ModernButton" Margin="4,0,0,0"
                                    Command="{Binding ResetSteerAngleCommand}"
                                    ToolTip.Tip="Reset steering to 0Â° (straight ahead)">
                                <TextBlock Text=">0&lt;" FontSize="14" FontWeight="Bold"/>
                            </Button>
                        </Grid>

                        <!-- Row 2: Steering Controls -->
                        <Grid ColumnDefinitions="Auto,*,Auto">
                            <Button Grid.Column="0" Classes="ModernButton" Width="40" Margin="0,0,8,0"
                                    Command="{Binding SimulatorSteerLeftCommand}"
                                    ToolTip.Tip="Steer left">
                                <TextBlock Text="â—€" FontSize="16"/>
                            </Button>
                            <Slider Grid.Column="1" Margin="0"
                                    Minimum="-40" Maximum="40"
                                    Value="{Binding SimulatorSteerAngle, Mode=TwoWay}"
                                    TickFrequency="5"
                                    IsSnapToTickEnabled="True"
                                    ToolTip.Tip="Steering angle"/>
                            <Button Grid.Column="2" Classes="ModernButton" Width="40" Margin="8,0,0,0"
                                    Command="{Binding SimulatorSteerRightCommand}"
                                    ToolTip.Tip="Steer right">
                                <TextBlock Text="â–¶" FontSize="16"/>
                            </Button>
                        </Grid>

                        <!-- Row 3: Steer Angle Display -->
                        <TextBlock Text="{Binding SimulatorSteerAngleDisplay, Mode=OneWay}"
                                   HorizontalAlignment="Center"
                                   FontSize="12"
                                   Foreground="#DDD"/>

                        <Separator Background="#555" Height="1" Margin="0,4"/>

                        <!-- Row 4: Speed Controls (3 buttons in a row) -->
                        <Grid ColumnDefinitions="*,*,*">
                            <Button Grid.Column="0" Classes="ModernButton" Margin="0,0,4,0"
                                    Command="{Binding SimulatorReverseCommand}"
                                    ToolTip.Tip="Accelerate backward">
                                <TextBlock Text="â–¼" FontSize="18"/>
                            </Button>
                            <Button Grid.Column="1" Classes="ModernButton" Margin="4,0,4,0"
                                    Command="{Binding SimulatorStopCommand}"
                                    ToolTip.Tip="Stop">
                                <TextBlock Text="â– " FontSize="18"/>
                            </Button>
                            <Button Grid.Column="2" Classes="ModernButton" Margin="4,0,0,0"
                                    Command="{Binding SimulatorForwardCommand}"
                                    ToolTip.Tip="Accelerate forward">
                                <TextBlock Text="â–²" FontSize="18"/>
                            </Button>
                        </Grid>

                        <!-- Row 5: Reverse Direction -->
                        <Button Classes="ModernButton"
                                Command="{Binding SimulatorReverseDirectionCommand}"
                                ToolTip.Tip="Reverse direction (180Â° turn)">
                            <StackPanel Orientation="Horizontal" Spacing="6">
                                <TextBlock Text="â†»" FontSize="16"/>
                                <TextBlock Text="Reverse Direction" FontSize="12"/>
                            </StackPanel>
                        </Button>
                    </StackPanel>
                </StackPanel>
            </Border>
        </Canvas>

        <!-- BOTTOM BAR: Function Buttons (horizontal) -->
        <Border Classes="FloatingPanel"
                ZIndex="10"
                Margin="20"
                HorizontalAlignment="Center"
                VerticalAlignment="Bottom"
                IsHitTestVisible="True">
            <StackPanel Orientation="Horizontal" Spacing="8">
                <Button Classes="ModernButton" Content="ðŸŽ¯ Auto" Width="80"/>
                <Button Classes="ModernButton" Content="ðŸ“ Mark" Width="80"/>
                <Button Classes="ModernButton" Content="ðŸ”„ Reset" Width="80"/>
            </StackPanel>
        </Border>

        <!-- Boundary Management Panel (Draggable) - Styled like AgOpenGPS -->
        <Canvas>
            <Border x:Name="BoundaryRecordingPanel"
                    Classes="FloatingPanel"
                    ZIndex="20"
                    Canvas.Left="200" Canvas.Top="150"
                    IsVisible="{Binding IsBoundaryPanelVisible}"
                    IsHitTestVisible="True"
                    MinWidth="420">
                <StackPanel Spacing="4">
                    <!-- Header: Drag handle + Title + Close button -->
                    <Grid ColumnDefinitions="Auto,*,Auto" Height="32" Margin="0,0,0,4"
                          Background="#DD2C3E50" Cursor="Hand"
                          PointerPressed="BoundaryPanel_PointerPressed"
                          PointerMoved="BoundaryPanel_PointerMoved"
                          PointerReleased="BoundaryPanel_PointerReleased"
                          ToolTip.Tip="Drag to move">
                        <TextBlock Grid.Column="0" Text="â‰¡" FontSize="18" FontWeight="Bold"
                                   Foreground="#FFFFFF" VerticalAlignment="Center" Margin="8,0,0,0"/>
                        <TextBlock Grid.Column="1" Text="Start or Delete A Boundary" FontSize="14" FontWeight="SemiBold"
                                   Foreground="#1ABC9C" HorizontalAlignment="Center" VerticalAlignment="Center"/>
                        <Button Grid.Column="2" Content="âœ•" Width="28" Height="28" Margin="0,0,4,0"
                                Background="Transparent" BorderThickness="0" Foreground="#FFFFFF"
                                Click="BtnCloseBoundaryPanel_Click" Cursor="Hand"
                                HorizontalContentAlignment="Center" VerticalContentAlignment="Center"/>
                    </Grid>

                    <!-- Toolbar Row: Delete, KML Import, Bing, Build From Tracks, Drive Around, Accept -->
                    <Grid ColumnDefinitions="*,*,*,*,*,*" Margin="4,4,4,8">
                        <Button x:Name="BtnDeleteBoundary" Grid.Column="0" Classes="ModernButton" Margin="2" Height="50"
                                Click="BtnDeleteBoundary_Click" ToolTip.Tip="Delete selected boundary">
                            <Image Source="/Assets/Icons/Trash.png" Width="32" Height="32"/>
                        </Button>
                        <Button x:Name="BtnKmlImport" Grid.Column="1" Classes="ModernButton" Margin="2" Height="50"
                                Click="BtnKmlImportBoundary_Click" ToolTip.Tip="Import boundary from KML file">
                            <Image Source="/Assets/Icons/BoundaryLoadFromGE.png" Width="32" Height="32"/>
                        </Button>
                        <Button x:Name="BtnBingMap" Grid.Column="2" Classes="ModernButton" Margin="2" Height="50"
                                Click="BtnBingMap_Click" ToolTip.Tip="Draw boundary on satellite map">
                            <Image Source="/Assets/Icons/BoundaryByMap.png" Width="32" Height="32"/>
                        </Button>
                        <Button x:Name="BtnBuildFromTracks" Grid.Column="3" Classes="ModernButton" Margin="2" Height="50"
                                Click="BtnBuildFromTracks_Click" ToolTip.Tip="Build boundary from driven tracks">
                            <Image Source="/Assets/Icons/BoundaryFromTracks.png" Width="32" Height="32"/>
                        </Button>
                        <Button x:Name="BtnDriveAroundField" Grid.Column="4" Classes="ModernButton" Margin="2" Height="50"
                                Click="BtnDriveAroundField_Click" ToolTip.Tip="Drive around field to record boundary">
                            <Image Source="/Assets/Icons/ST_SteerTab.png" Width="32" Height="32"/>
                        </Button>
                        <Button x:Name="BtnAcceptBoundary" Grid.Column="5" Classes="ModernButton" Margin="2" Height="50"
                                Click="BtnCloseBoundaryPanel_Click" ToolTip.Tip="Accept and close">
                            <Image Source="/Assets/Icons/OK64.png" Width="32" Height="32"/>
                        </Button>
                    </Grid>

                    <!-- Column Headers -->
                    <Grid ColumnDefinitions="*,*,*" Background="#3498DB" Margin="4,0,4,0">
                        <TextBlock Grid.Column="0" Text="Boundary" HorizontalAlignment="Center"
                                   FontWeight="Bold" Foreground="White" Padding="8,6"/>
                        <TextBlock Grid.Column="1" Text="Area" HorizontalAlignment="Center"
                                   FontWeight="Bold" Foreground="White" Padding="8,6"/>
                        <TextBlock Grid.Column="2" Text="Drive Thru" HorizontalAlignment="Center"
                                   FontWeight="Bold" Foreground="White" Padding="8,6"/>
                    </Grid>

                    <!-- Boundary List -->
                    <Border Background="#DD1a252f" Margin="4,0,4,4" MinHeight="60" MaxHeight="150">
                        <ScrollViewer>
                            <StackPanel x:Name="BoundaryListPanel" Spacing="1">
                                <!-- Boundary items will be populated dynamically -->
                            </StackPanel>
                        </ScrollViewer>
                    </Border>

                    <!-- Recording Status (shown when recording) -->
                    <Border x:Name="RecordingStatusPanel" Background="#DD2C3E50" CornerRadius="4"
                            Padding="8" Margin="4,0,4,4" IsVisible="False">
                        <Grid RowDefinitions="Auto,Auto,Auto" ColumnDefinitions="Auto,*">
                            <TextBlock Grid.Row="0" Grid.Column="0" Text="Status: " Foreground="#888" FontSize="12"/>
                            <TextBlock Grid.Row="0" Grid.Column="1" x:Name="BoundaryStatusLabel" Text="Idle"
                                       Foreground="#1ABC9C" FontSize="12" FontWeight="Bold"/>
                            <TextBlock Grid.Row="1" Grid.Column="0" Text="Points: " Foreground="#888" FontSize="12"/>
                            <TextBlock Grid.Row="1" Grid.Column="1" x:Name="BoundaryPointsLabel" Text="0"
                                       Foreground="White" FontSize="12" FontWeight="Bold"/>
                            <TextBlock Grid.Row="2" Grid.Column="0" Text="Area: " Foreground="#888" FontSize="12"/>
                            <TextBlock Grid.Row="2" Grid.Column="1" x:Name="BoundaryAreaLabel" Text="0.00 Ha"
                                       Foreground="White" FontSize="12" FontWeight="Bold"/>
                        </Grid>
                    </Border>

                    <!-- Recording Controls (shown when recording) -->
                    <Grid x:Name="RecordingControlsPanel" ColumnDefinitions="*,*,*,*" Margin="4,0,4,4" IsVisible="False">
                        <Button Grid.Column="0" Classes="ModernButton" Margin="2" Height="40"
                                Click="BtnOuterBoundary_Click" ToolTip.Tip="Outer boundary">
                            <TextBlock Text="Outer" FontWeight="Bold"/>
                        </Button>
                        <Button Grid.Column="1" Classes="ModernButton" Margin="2" Height="40"
                                Click="BtnInnerBoundary_Click" ToolTip.Tip="Inner boundary">
                            <TextBlock Text="Inner" FontWeight="Bold"/>
                        </Button>
                        <Button Grid.Column="2" Classes="ModernButton" Margin="2" Height="40"
                                Click="BtnPauseBoundary_Click" ToolTip.Tip="Pause recording">
                            <Image Source="/Assets/Icons/boundaryPause.png" Width="24" Height="24"/>
                        </Button>
                        <Button Grid.Column="3" Classes="ModernButton" Margin="2" Height="40"
                                Click="BtnUndoBoundaryPoint_Click" ToolTip.Tip="Undo last point">
                            <TextBlock Text="â†©" FontSize="18"/>
                        </Button>
                    </Grid>

                    <!-- Add Boundary Choice Panel (shown when Add button is clicked) -->
                    <Border x:Name="AddBoundaryChoicePanel" Background="#DDf0f0f0" CornerRadius="4"
                            Padding="12" Margin="4,0,4,4" IsVisible="False">
                        <StackPanel Spacing="12">
                            <!-- Title -->
                            <TextBlock Text="Start or Delete A Boundary" HorizontalAlignment="Center"
                                       FontSize="14" FontWeight="Bold" Foreground="#333"/>

                            <!-- Import KML Button -->
                            <Button Classes="ModernButton" Height="80" Background="#FFFFFF"
                                    Click="BtnImportKml_Click" HorizontalAlignment="Center" Width="90"
                                    ToolTip.Tip="Import boundary from KML file">
                                <Image Source="/Assets/Icons/BoundaryLoadFromGE.png" Width="64" Height="64"/>
                            </Button>

                            <!-- Drive/Record Button -->
                            <Button Classes="ModernButton" Height="80" Background="#FFFFFF"
                                    Click="BtnDriveRecord_Click" HorizontalAlignment="Center" Width="90"
                                    ToolTip.Tip="Drive around the field to record boundary">
                                <Image Source="/Assets/Icons/SteerRight.png" Width="64" Height="64"/>
                            </Button>

                            <!-- Cancel Button -->
                            <Button Classes="ModernButton" Height="60" Background="#FFFFFF"
                                    Click="BtnCancelAddBoundary_Click" HorizontalAlignment="Right" Width="70"
                                    ToolTip.Tip="Cancel">
                                <Image Source="/Assets/Icons/Cancel64.png" Width="48" Height="48"/>
                            </Button>
                        </StackPanel>
                    </Border>
                </StackPanel>
            </Border>
        </Canvas>

        <!-- Boundary Player Panel (FormBoundaryPlayer equivalent - Drive/Record mode) -->
        <Canvas>
            <Border x:Name="BoundaryPlayerPanel"
                    Classes="FloatingPanel"
                    ZIndex="25"
                    Canvas.Left="100" Canvas.Top="100"
                    IsVisible="False"
                    IsHitTestVisible="True"
                    MinWidth="250">
                <StackPanel Spacing="4">
                    <!-- Header: Drag handle + Title -->
                    <Grid ColumnDefinitions="Auto,*" Height="32" Margin="0,0,0,4"
                          Background="#DD2C3E50" Cursor="Hand"
                          PointerPressed="BoundaryPlayerPanel_PointerPressed"
                          PointerMoved="BoundaryPlayerPanel_PointerMoved"
                          PointerReleased="BoundaryPlayerPanel_PointerReleased"
                          ToolTip.Tip="Drag to move">
                        <TextBlock Grid.Column="0" Text="â‰¡" FontSize="18" FontWeight="Bold"
                                   Foreground="#FFFFFF" VerticalAlignment="Center" Margin="8,0,0,0"/>
                        <TextBlock Grid.Column="1" Text="Stop Record Pause Boundary" FontSize="12" FontWeight="SemiBold"
                                   Foreground="#1ABC9C" HorizontalAlignment="Center" VerticalAlignment="Center"/>
                    </Grid>

                    <!-- Offset Distance Input (clickable to open numeric keypad) -->
                    <Grid ColumnDefinitions="Auto,*" Margin="8,4">
                        <Button Grid.Column="0" Background="AliceBlue" CornerRadius="4" Padding="8,4" MinWidth="100"
                                Click="BtnBoundaryOffset_Click" Cursor="Hand"
                                ToolTip.Tip="Click to enter offset distance">
                            <TextBlock x:Name="BoundaryOffsetValue" Text="0" FontSize="22" FontWeight="Bold"
                                       Foreground="Black" HorizontalAlignment="Center"/>
                        </Button>
                        <TextBlock Grid.Column="1" x:Name="BoundaryOffsetUnit" Text="cm" FontSize="14" FontWeight="Bold"
                                   Foreground="White" VerticalAlignment="Center" Margin="8,0,0,0"/>
                    </Grid>

                    <!-- Two Column Layout -->
                    <Grid ColumnDefinitions="*,*" RowDefinitions="Auto,Auto,Auto,Auto,Auto" Margin="4">
                        <!-- Row 0: Trash (restart) | Section Control -->
                        <Button x:Name="BtnBoundaryRestart" Grid.Column="0" Grid.Row="0" Classes="ModernButton"
                                Margin="2" Height="56" Click="BtnBoundaryRestart_Click"
                                ToolTip.Tip="Delete all points and restart">
                            <Image Source="/Assets/Icons/Trash.png" Width="40" Height="40"/>
                        </Button>
                        <ToggleButton x:Name="BtnBoundarySectionControl" Grid.Column="1" Grid.Row="0"
                                      Margin="2" Height="56" Checked="BtnBoundarySectionControl_Checked"
                                      Unchecked="BtnBoundarySectionControl_Unchecked"
                                      ToolTip.Tip="Record boundary when section is on">
                            <ToggleButton.Styles>
                                <Style Selector="ToggleButton">
                                    <Setter Property="Background" Value="#3498DB"/>
                                    <Setter Property="CornerRadius" Value="6"/>
                                    <Setter Property="Cursor" Value="Hand"/>
                                    <Setter Property="BorderThickness" Value="0"/>
                                    <Setter Property="Padding" Value="12,6"/>
                                </Style>
                                <Style Selector="ToggleButton:pointerover">
                                    <Setter Property="Background" Value="#2980B9"/>
                                </Style>
                                <Style Selector="ToggleButton:checked">
                                    <Setter Property="Background" Value="#1ABC9C"/>
                                </Style>
                                <Style Selector="ToggleButton:checked:pointerover">
                                    <Setter Property="Background" Value="#16A085"/>
                                </Style>
                            </ToggleButton.Styles>
                            <Image Source="/Assets/Icons/BoundarySectionControlOnOff.png" Width="40" Height="40"/>
                        </ToggleButton>

                        <!-- Row 1: Delete Last Point | Add Point -->
                        <Button x:Name="BtnBoundaryDeleteLast" Grid.Column="0" Grid.Row="1" Classes="ModernButton"
                                Margin="2" Height="56" Click="BtnBoundaryDeleteLast_Click"
                                ToolTip.Tip="Delete last point">
                            <Image Source="/Assets/Icons/PointDelete.png" Width="40" Height="40"/>
                        </Button>
                        <Button x:Name="BtnBoundaryAddPoint" Grid.Column="1" Grid.Row="1" Classes="ModernButton"
                                Margin="2" Height="56" Click="BtnBoundaryAddPoint_Click"
                                ToolTip.Tip="Add point manually">
                            <Image Source="/Assets/Icons/PointAdd.png" Width="40" Height="40"/>
                        </Button>

                        <!-- Row 2: Left/Right toggle | Antenna/Tool toggle -->
                        <Button x:Name="BtnBoundaryLeftRight" Grid.Column="0" Grid.Row="2" Classes="ModernButton"
                                Margin="2" Height="56" Click="BtnBoundaryLeftRight_Click"
                                ToolTip.Tip="Toggle left/right side">
                            <Image x:Name="BoundaryLeftRightImage" Source="/Assets/Icons/BoundaryLeft.png" Width="40" Height="40"/>
                        </Button>
                        <Button x:Name="BtnBoundaryAntennaTool" Grid.Column="1" Grid.Row="2" Classes="ModernButton"
                                Margin="2" Height="56" Click="BtnBoundaryAntennaTool_Click"
                                ToolTip.Tip="Toggle antenna/tool position">
                            <Image x:Name="BoundaryAntennaToolImage" Source="/Assets/Icons/BoundaryRecordTool.png" Width="40" Height="40"/>
                        </Button>

                        <!-- Row 3: Points display | Area display -->
                        <StackPanel Grid.Column="0" Grid.Row="3" Margin="4">
                            <TextBlock Text="Points:" Foreground="#888" FontSize="12"/>
                            <TextBlock x:Name="BoundaryPlayerPointsLabel" Text="0" Foreground="White"
                                       FontSize="16" FontWeight="Bold"/>
                        </StackPanel>
                        <StackPanel Grid.Column="1" Grid.Row="3" Margin="4">
                            <TextBlock Text="Area:" Foreground="#888" FontSize="12"/>
                            <TextBlock x:Name="BoundaryPlayerAreaLabel" Text="0" Foreground="White"
                                       FontSize="16" FontWeight="Bold"/>
                        </StackPanel>

                        <!-- Row 4: OK (stop/accept) | Record/Pause toggle -->
                        <Button x:Name="BtnBoundaryStop" Grid.Column="0" Grid.Row="4" Classes="ModernButton"
                                Margin="2" Height="64" Click="BtnBoundaryStop_Click"
                                ToolTip.Tip="Stop recording and save boundary">
                            <Image Source="/Assets/Icons/OK64.png" Width="48" Height="48"/>
                        </Button>
                        <Button x:Name="BtnBoundaryPausePlay" Grid.Column="1" Grid.Row="4" Classes="ModernButton"
                                Margin="2" Height="64" Click="BtnBoundaryPausePlay_Click"
                                ToolTip.Tip="Start/Pause recording">
                            <Image x:Name="BoundaryPausePlayImage" Source="/Assets/Icons/BoundaryRecord.png" Width="48" Height="48"/>
                        </Button>
                    </Grid>
                </StackPanel>
            </Border>
        </Canvas>

        <!-- Draggable Section Control (using Canvas for absolute positioning) -->
        <Canvas>
        <Border x:Name="SectionControlPanel"
                ZIndex="10"
                Canvas.Left="900" Canvas.Top="600"
                Classes="FloatingPanel"
                Cursor="Hand"
                PointerPressed="SectionControl_PointerPressed"
                PointerMoved="SectionControl_PointerMoved"
                PointerReleased="SectionControl_PointerReleased">
            <StackPanel Orientation="Horizontal" Spacing="6">
                <TextBlock Text="â‰¡" Foreground="#888" FontSize="16" FontWeight="Bold"
                           VerticalAlignment="Center" Margin="0,0,4,0" ToolTip.Tip="Drag to move"/>
                <TextBlock Text="Sections" Foreground="White" FontSize="12" FontWeight="Bold"
                           VerticalAlignment="Center" Margin="0,0,8,0"/>

                <!-- Section Buttons in single horizontal row -->
                <StackPanel Orientation="Horizontal" Spacing="4">
                    <Border Background="#E74C3C" CornerRadius="4" Height="32" Width="45">
                        <TextBlock Text="1" HorizontalAlignment="Center" VerticalAlignment="Center"
                                   Foreground="White" FontWeight="Bold" FontSize="14"/>
                    </Border>
                    <Border Background="#E74C3C" CornerRadius="4" Height="32" Width="45">
                        <TextBlock Text="2" HorizontalAlignment="Center" VerticalAlignment="Center"
                                   Foreground="White" FontWeight="Bold" FontSize="14"/>
                    </Border>
                    <Border Background="#E74C3C" CornerRadius="4" Height="32" Width="45">
                        <TextBlock Text="3" HorizontalAlignment="Center" VerticalAlignment="Center"
                                   Foreground="White" FontWeight="Bold" FontSize="14"/>
                    </Border>
                    <Border Background="#E74C3C" CornerRadius="4" Height="32" Width="45">
                        <TextBlock Text="4" HorizontalAlignment="Center" VerticalAlignment="Center"
                                   Foreground="White" FontWeight="Bold" FontSize="14"/>
                    </Border>
                    <Border Background="#E74C3C" CornerRadius="4" Height="32" Width="45">
                        <TextBlock Text="5" HorizontalAlignment="Center" VerticalAlignment="Center"
                                   Foreground="White" FontWeight="Bold" FontSize="14"/>
                    </Border>
                    <Border Background="#E74C3C" CornerRadius="4" Height="32" Width="45">
                        <TextBlock Text="6" HorizontalAlignment="Center" VerticalAlignment="Center"
                                   Foreground="White" FontWeight="Bold" FontSize="14"/>
                    </Border>
                </StackPanel>
            </StackPanel>
        </Border>
        </Canvas>
    </Grid>
</UserControl>
