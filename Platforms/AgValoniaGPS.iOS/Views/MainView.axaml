<UserControl xmlns="https://github.com/avaloniaui"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
        xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
        xmlns:vm="using:AgValoniaGPS.ViewModels"
        xmlns:controls="using:AgValoniaGPS.iOS.Controls"
        mc:Ignorable="d" d:DesignWidth="390" d:DesignHeight="844"
        x:Class="AgValoniaGPS.iOS.Views.MainView"
        x:DataType="vm:MainViewModel"
        Background="#1a1a1a">

    <UserControl.Styles>
        <!-- iOS Tab Bar Button -->
        <Style Selector="Button.TabButton">
            <Setter Property="Background" Value="Transparent"/>
            <Setter Property="BorderThickness" Value="0"/>
            <Setter Property="Padding" Value="8"/>
            <Setter Property="MinWidth" Value="70"/>
            <Setter Property="MinHeight" Value="50"/>
        </Style>
        <Style Selector="Button.TabButton:pressed">
            <Setter Property="Background" Value="#333"/>
        </Style>

        <!-- Status panel style -->
        <Style Selector="Border.StatusPanel">
            <Setter Property="Background" Value="#CC1a1a1a"/>
            <Setter Property="CornerRadius" Value="8"/>
            <Setter Property="Padding" Value="12,8"/>
        </Style>

        <!-- iOS Action Button -->
        <Style Selector="Button.ActionButton">
            <Setter Property="Width" Value="56"/>
            <Setter Property="Height" Value="56"/>
            <Setter Property="CornerRadius" Value="28"/>
            <Setter Property="Background" Value="#DD2C3E50"/>
            <Setter Property="BorderThickness" Value="0"/>
            <Setter Property="Padding" Value="0"/>
        </Style>
        <Style Selector="Button.ActionButton:pressed">
            <Setter Property="Background" Value="#DD1ABC9C"/>
        </Style>

        <!-- iOS Small Action Button -->
        <Style Selector="Button.SmallActionButton">
            <Setter Property="Width" Value="44"/>
            <Setter Property="Height" Value="44"/>
            <Setter Property="CornerRadius" Value="8"/>
            <Setter Property="Background" Value="#DD2C3E50"/>
            <Setter Property="BorderThickness" Value="0"/>
            <Setter Property="Padding" Value="0"/>
        </Style>
        <Style Selector="Button.SmallActionButton:pressed">
            <Setter Property="Background" Value="#DD1ABC9C"/>
        </Style>

        <!-- Modal Sheet Style -->
        <Style Selector="Border.ModalSheet">
            <Setter Property="Background" Value="#1E2A38"/>
            <Setter Property="CornerRadius" Value="20,20,0,0"/>
            <Setter Property="Padding" Value="16"/>
        </Style>

        <!-- Sheet Button -->
        <Style Selector="Button.SheetButton">
            <Setter Property="Background" Value="#34495E"/>
            <Setter Property="Foreground" Value="White"/>
            <Setter Property="CornerRadius" Value="12"/>
            <Setter Property="Height" Value="60"/>
            <Setter Property="BorderThickness" Value="0"/>
            <Setter Property="Padding" Value="16,8"/>
            <Setter Property="HorizontalContentAlignment" Value="Left"/>
        </Style>
        <Style Selector="Button.SheetButton:pressed">
            <Setter Property="Background" Value="#1ABC9C"/>
        </Style>

        <!-- Compact Button for horizontal layouts -->
        <Style Selector="Button.CompactButton">
            <Setter Property="Background" Value="#34495E"/>
            <Setter Property="Foreground" Value="White"/>
            <Setter Property="CornerRadius" Value="8"/>
            <Setter Property="Height" Value="36"/>
            <Setter Property="BorderThickness" Value="0"/>
            <Setter Property="Padding" Value="12,6"/>
        </Style>
        <Style Selector="Button.CompactButton:pressed">
            <Setter Property="Background" Value="#1ABC9C"/>
        </Style>
    </UserControl.Styles>

    <!-- LANDSCAPE LAYOUT: Left Nav Bar | Map Area -->
    <Grid ColumnDefinitions="Auto,*">

        <!-- LEFT NAVIGATION BAR -->
        <Border Grid.Column="0" Background="#DD1E2A38" Padding="4" Width="64">
            <StackPanel Spacing="4" VerticalAlignment="Top" Margin="0,8,0,0">
                <!-- 1. File Menu -->
                <Button Classes="SmallActionButton" Width="56" Height="56" Command="{Binding ToggleFileMenuCommand}" ToolTip.Tip="File Menu">
                    <Image Source="avares://AgValoniaGPS.iOS/Assets/Icons/fileMenu.png" Width="40" Height="40" Stretch="Uniform"/>
                </Button>
                <!-- 2. View Settings -->
                <Button Classes="SmallActionButton" Width="56" Height="56" Command="{Binding ToggleViewSettingsPanelCommand}" ToolTip.Tip="View Settings">
                    <Image Source="avares://AgValoniaGPS.iOS/Assets/Icons/NavigationSettings.png" Width="40" Height="40" Stretch="Uniform"/>
                </Button>
                <!-- 3. Tools -->
                <Button Classes="SmallActionButton" Width="56" Height="56" Command="{Binding ToggleToolsPanelCommand}" ToolTip.Tip="Tools">
                    <Image Source="avares://AgValoniaGPS.iOS/Assets/Icons/SpecialFunctions.png" Width="40" Height="40" Stretch="Uniform"/>
                </Button>
                <!-- 4. Configuration -->
                <Button Classes="SmallActionButton" Width="56" Height="56" Command="{Binding ToggleSettingsCommand}" ToolTip.Tip="Configuration">
                    <Image Source="avares://AgValoniaGPS.iOS/Assets/Icons/Settings48.png" Width="40" Height="40" Stretch="Uniform"/>
                </Button>
                <!-- 5. Job Menu -->
                <Button Classes="SmallActionButton" Width="56" Height="56" Command="{Binding ToggleJobMenuPanelCommand}" ToolTip.Tip="Job Menu">
                    <Image Source="avares://AgValoniaGPS.iOS/Assets/Icons/JobActive.png" Width="40" Height="40" Stretch="Uniform"/>
                </Button>
                <!-- 6. Field Tools -->
                <Button Classes="SmallActionButton" Width="56" Height="56" Command="{Binding ToggleFieldToolsCommand}" ToolTip.Tip="Field Tools">
                    <Image Source="avares://AgValoniaGPS.iOS/Assets/Icons/FieldTools.png" Width="40" Height="40" Stretch="Uniform"/>
                </Button>
                <!-- 7. AutoSteer Config -->
                <Button Classes="SmallActionButton" Width="56" Height="56" ToolTip.Tip="AutoSteer Config">
                    <Image Source="avares://AgValoniaGPS.iOS/Assets/Icons/AutoSteerConf.png" Width="40" Height="40" Stretch="Uniform"/>
                </Button>
                <!-- 8. Data I/O -->
                <Button Classes="SmallActionButton" Width="56" Height="56" Command="{Binding ShowDataIODialogCommand}" ToolTip.Tip="Data I/O">
                    <Image Source="avares://AgValoniaGPS.iOS/Assets/Icons/AgIO.png" Width="40" Height="40" Stretch="Uniform"/>
                </Button>
            </StackPanel>
        </Border>

        <!-- MAP AREA (Column 1) -->
        <Grid Grid.Column="1">
            <!-- SkiaSharp Map Control -->
            <controls:SkiaMapControl x:Name="MapControl" IsGridVisible="True" />

            <!-- TOP STATUS BAR -->
            <Grid Margin="16,16,16,0" VerticalAlignment="Top" ColumnDefinitions="Auto,Auto,*,Auto,Auto">
                <!-- GPS Status -->
                <Border Grid.Column="0" Classes="StatusPanel">
                    <StackPanel Orientation="Horizontal" Spacing="8">
                        <Ellipse Width="14" Height="14"
                                 Fill="{Binding FixQuality, Converter={StaticResource FixQualityToColorConverter}}"/>
                        <TextBlock Text="{Binding FixQuality}" Foreground="White" FontSize="16" FontWeight="Bold"/>
                    </StackPanel>
                </Border>

                <!-- Speed Display -->
                <Border Grid.Column="1" Classes="StatusPanel" Margin="8,0,0,0">
                    <StackPanel Orientation="Horizontal" Spacing="4">
                        <TextBlock Text="{Binding Speed, StringFormat={}{0:F1}}" Foreground="White" FontSize="20" FontWeight="Bold"/>
                        <TextBlock Text="km/h" Foreground="#888" FontSize="12" VerticalAlignment="Bottom" Margin="0,0,0,2"/>
                    </StackPanel>
                </Border>

                <!-- Cross-Track Error (Center - Large) -->
                <Border Grid.Column="2" Classes="StatusPanel" HorizontalAlignment="Center">
                    <StackPanel Orientation="Horizontal" Spacing="4">
                        <TextBlock Text="XTE" Foreground="#1ABC9C" FontSize="14" FontWeight="Bold" VerticalAlignment="Center"/>
                        <TextBlock Text="{Binding CrossTrackError, StringFormat={}{0:F2}}" Foreground="Yellow" FontSize="32" FontWeight="Bold"/>
                        <TextBlock Text="m" Foreground="#888" FontSize="14" VerticalAlignment="Bottom" Margin="0,0,0,4"/>
                    </StackPanel>
                </Border>

                <!-- Heading -->
                <Border Grid.Column="3" Classes="StatusPanel" Margin="0,0,8,0">
                    <StackPanel Orientation="Horizontal" Spacing="2">
                        <TextBlock Text="{Binding Heading, StringFormat={}{0:F0}}" Foreground="White" FontSize="20" FontWeight="Bold"/>
                        <TextBlock Text="Â°" Foreground="#888" FontSize="16"/>
                    </StackPanel>
                </Border>

                <!-- Steer Indicator -->
                <Border Grid.Column="4" Classes="StatusPanel">
                    <TextBlock Text="âŸ³" Foreground="#3498DB" FontSize="24" FontWeight="Bold"/>
                </Border>
            </Grid>

            <!-- RIGHT SIDE: Zoom Controls -->
            <StackPanel Orientation="Vertical" Spacing="8"
                        Margin="0,0,16,0"
                        HorizontalAlignment="Right"
                        VerticalAlignment="Center">
                <Button Classes="SmallActionButton" Command="{Binding ZoomInCommand}">
                    <TextBlock Text="+" FontSize="24" Foreground="White" HorizontalAlignment="Center"/>
                </Button>
                <Button Classes="SmallActionButton" Command="{Binding Toggle3DModeCommand}">
                    <TextBlock Text="3D" FontSize="14" Foreground="White" FontWeight="Bold" HorizontalAlignment="Center"/>
                </Button>
                <Button Classes="SmallActionButton" Command="{Binding ZoomOutCommand}">
                    <TextBlock Text="âˆ’" FontSize="24" Foreground="White" HorizontalAlignment="Center"/>
                </Button>
            </StackPanel>

            <!-- BOTTOM-LEFT: Simulator Controls (when visible) - Single row -->
            <Border Classes="StatusPanel"
                    Margin="16,0,0,16"
                    HorizontalAlignment="Left"
                    VerticalAlignment="Bottom"
                    IsVisible="{Binding IsSimulatorPanelVisible}">
                <StackPanel Orientation="Horizontal" Spacing="4">
                    <!-- Sim ON/OFF -->
                    <ToggleButton IsChecked="{Binding IsSimulatorEnabled}" Width="40" Height="32" CornerRadius="6" Padding="0">
                        <ToggleButton.Styles>
                            <Style Selector="ToggleButton">
                                <Setter Property="Background" Value="#555"/>
                            </Style>
                            <Style Selector="ToggleButton:checked">
                                <Setter Property="Background" Value="#1ABC9C"/>
                            </Style>
                        </ToggleButton.Styles>
                        <TextBlock Text="Sim" Foreground="White" FontSize="10" FontWeight="Bold"/>
                    </ToggleButton>
                    <!-- Coords -->
                    <Button Classes="CompactButton" Height="32" Command="{Binding ShowSimCoordsPanelCommand}">
                        <TextBlock Text="Coords" Foreground="White" FontSize="10"/>
                    </Button>
                    <!-- Reset -->
                    <Button Classes="CompactButton" Height="32" Command="{Binding ResetSimulatorCommand}">
                        <TextBlock Text="Reset" Foreground="White" FontSize="10"/>
                    </Button>
                    <!-- Turn Left -->
                    <Button Classes="SmallActionButton" Width="32" Height="32" Command="{Binding SimulatorSteerLeftCommand}">
                        <TextBlock Text="â—€" FontSize="14" Foreground="White"/>
                    </Button>
                    <!-- Zero Turn -->
                    <Button Classes="CompactButton" Height="32" Command="{Binding ResetSteerAngleCommand}">
                        <TextBlock Text="Zero" Foreground="White" FontSize="10"/>
                    </Button>
                    <!-- Turn Right -->
                    <Button Classes="SmallActionButton" Width="32" Height="32" Command="{Binding SimulatorSteerRightCommand}">
                        <TextBlock Text="â–¶" FontSize="14" Foreground="White"/>
                    </Button>
                    <!-- Accel -->
                    <Button Classes="SmallActionButton" Width="32" Height="32" Command="{Binding SimulatorForwardCommand}">
                        <TextBlock Text="â–²" FontSize="14" Foreground="White"/>
                    </Button>
                    <!-- Stop -->
                    <Button Classes="SmallActionButton" Width="32" Height="32" Command="{Binding SimulatorStopCommand}">
                        <TextBlock Text="â– " FontSize="10" Foreground="White"/>
                    </Button>
                    <!-- Decel -->
                    <Button Classes="SmallActionButton" Width="32" Height="32" Command="{Binding SimulatorReverseCommand}">
                        <TextBlock Text="â–¼" FontSize="14" Foreground="White"/>
                    </Button>
                    <!-- Close -->
                    <Button Classes="SmallActionButton" Width="32" Height="32" Background="#8B0000" Command="{Binding ToggleSimulatorPanelCommand}">
                        <TextBlock Text="âœ•" FontSize="10" Foreground="White"/>
                    </Button>
                </StackPanel>
            </Border>

            <!-- BOTTOM-CENTER: Position Info -->
            <Border Classes="StatusPanel"
                    Margin="0,0,0,16"
                    HorizontalAlignment="Center"
                    VerticalAlignment="Bottom"
                    IsVisible="{Binding !IsSimCoordsPanelVisible}">
                <StackPanel Orientation="Horizontal" Spacing="20">
                    <StackPanel Orientation="Horizontal" Spacing="4">
                        <TextBlock Text="E" Foreground="#3498DB" FontSize="14" FontWeight="Bold"/>
                        <TextBlock Text="{Binding Easting, StringFormat={}{0:F1}}" Foreground="White" FontSize="16"/>
                    </StackPanel>
                    <StackPanel Orientation="Horizontal" Spacing="4">
                        <TextBlock Text="N" Foreground="#E74C3C" FontSize="14" FontWeight="Bold"/>
                        <TextBlock Text="{Binding Northing, StringFormat={}{0:F1}}" Foreground="White" FontSize="16"/>
                    </StackPanel>
                </StackPanel>
            </Border>

            <!-- SIM COORDS PANEL - Inline coordinate entry with tappable fields -->
            <Border Classes="StatusPanel"
                    Margin="0,0,0,16"
                    HorizontalAlignment="Center"
                    VerticalAlignment="Bottom"
                    IsVisible="{Binding IsSimCoordsPanelVisible}">
                <StackPanel Orientation="Horizontal" Spacing="8">
                    <TextBlock Text="Lat:" Foreground="#888" FontSize="12" VerticalAlignment="Center"/>
                    <Button x:Name="LatitudeButton" Classes="CompactButton" Width="110" Height="32" Padding="6,4" Click="OnLatitudeClick">
                        <TextBlock Text="{Binding SimCoordsLatitudeText}" Foreground="White" FontSize="12"/>
                    </Button>
                    <TextBlock Text="Lon:" Foreground="#888" FontSize="12" VerticalAlignment="Center"/>
                    <Button x:Name="LongitudeButton" Classes="CompactButton" Width="110" Height="32" Padding="6,4" Click="OnLongitudeClick">
                        <TextBlock Text="{Binding SimCoordsLongitudeText}" Foreground="White" FontSize="12"/>
                    </Button>
                    <Button Classes="CompactButton" Height="32" Command="{Binding ApplySimCoordsCommand}">
                        <TextBlock Text="Set" Foreground="White" FontSize="11"/>
                    </Button>
                    <Button Classes="CompactButton" Height="32" Background="#8B0000" Command="{Binding CancelSimCoordsCommand}">
                        <TextBlock Text="X" Foreground="White" FontSize="11"/>
                    </Button>
                </StackPanel>
            </Border>

            <!-- NUMERIC KEYPAD OVERLAY -->
            <Border x:Name="KeypadOverlay"
                    IsVisible="False"
                    Background="#AA000000"
                    HorizontalAlignment="Stretch"
                    VerticalAlignment="Stretch">
                <controls:NumericKeypad x:Name="NumericKeypad"
                                        HorizontalAlignment="Center"
                                        VerticalAlignment="Center"
                                        Width="240"/>
            </Border>

            <!-- FILE MENU SHEET (Button 1) - Single row compact layout -->
            <Border Classes="ModalSheet" VerticalAlignment="Bottom" Padding="12,8" IsVisible="{Binding IsFileMenuVisible}">
                <WrapPanel Orientation="Horizontal" HorizontalAlignment="Left">
                    <TextBlock Text="File" Foreground="#888" FontSize="14" FontWeight="Bold" VerticalAlignment="Center" Margin="0,0,8,0"/>
                    <Button Classes="CompactButton" Margin="2"><TextBlock Text="New Profile" Foreground="White" FontSize="12"/></Button>
                    <Button Classes="CompactButton" Margin="2"><TextBlock Text="Load Profile" Foreground="White" FontSize="12"/></Button>
                    <Button Classes="CompactButton" Margin="2"><TextBlock Text="Language" Foreground="White" FontSize="12"/></Button>
                    <Button Classes="CompactButton" Margin="2" Command="{Binding ShowSimulatorPanelCommand}"><TextBlock Text="Simulator" Foreground="White" FontSize="12"/></Button>
                    <Button Classes="CompactButton" Margin="2"><TextBlock Text="Kiosk" Foreground="White" FontSize="12"/></Button>
                    <Button Classes="CompactButton" Margin="2"><TextBlock Text="Reset ALL" Foreground="White" FontSize="12"/></Button>
                    <Button Classes="CompactButton" Margin="2"><TextBlock Text="About" Foreground="White" FontSize="12"/></Button>
                    <Button Classes="CompactButton" Margin="2" Command="{Binding ShowAgShareSettingsDialogCommand}"><TextBlock Text="AgShare" Foreground="White" FontSize="12"/></Button>
                    <Button Classes="CompactButton" Margin="2"><TextBlock Text="Help" Foreground="White" FontSize="12"/></Button>
                    <Button Classes="CompactButton" Margin="2,2,0,2" Background="#8B0000" Command="{Binding ToggleFileMenuCommand}"><TextBlock Text="âœ•" Foreground="White" FontSize="12"/></Button>
                </WrapPanel>
            </Border>

            <!-- FIELD TOOLS SHEET - with commands -->
            <Border Classes="ModalSheet" VerticalAlignment="Bottom" IsVisible="{Binding IsFieldToolsVisible}">
                <StackPanel Spacing="12">
                    <Grid ColumnDefinitions="*,Auto">
                        <StackPanel Grid.Column="0" Orientation="Horizontal" Spacing="12">
                            <TextBlock Text="ðŸ”§" FontSize="20"/>
                            <TextBlock Text="Field Tools" Foreground="White" FontSize="20" FontWeight="Bold" VerticalAlignment="Center"/>
                        </StackPanel>
                        <Button Grid.Column="1" Classes="SmallActionButton" Command="{Binding ToggleFieldToolsCommand}">
                            <TextBlock Text="âœ•" FontSize="18" Foreground="White"/>
                        </Button>
                    </Grid>
                    <Separator Background="#444" Height="1"/>
                    <Button Classes="SheetButton" Command="{Binding StartBoundaryRecordingCommand}"><StackPanel Orientation="Horizontal" Spacing="12"><TextBlock Text="âº" FontSize="24"/><TextBlock Text="Record Boundary" VerticalAlignment="Center" FontSize="16"/></StackPanel></Button>
                    <Button Classes="SheetButton" Command="{Binding DrawMapBoundaryCommand}"><StackPanel Orientation="Horizontal" Spacing="12"><TextBlock Text="âœï¸" FontSize="24"/><TextBlock Text="Draw on Map" VerticalAlignment="Center" FontSize="16"/></StackPanel></Button>
                    <Button Classes="SheetButton" Command="{Binding ShowKmlImportDialogCommand}"><StackPanel Orientation="Horizontal" Spacing="12"><TextBlock Text="ðŸŒ" FontSize="24"/><TextBlock Text="Import KML" VerticalAlignment="Center" FontSize="16"/></StackPanel></Button>
                </StackPanel>
            </Border>

            <!-- SETTINGS SHEET - with commands -->
            <Border Classes="ModalSheet" VerticalAlignment="Bottom" IsVisible="{Binding IsSettingsVisible}">
                <StackPanel Spacing="12">
                    <Grid ColumnDefinitions="*,Auto">
                        <StackPanel Grid.Column="0" Orientation="Horizontal" Spacing="12">
                            <TextBlock Text="âš™ï¸" FontSize="20"/>
                            <TextBlock Text="Settings" Foreground="White" FontSize="20" FontWeight="Bold" VerticalAlignment="Center"/>
                        </StackPanel>
                        <Button Grid.Column="1" Classes="SmallActionButton" Command="{Binding ToggleSettingsCommand}">
                            <TextBlock Text="âœ•" FontSize="18" Foreground="White"/>
                        </Button>
                    </Grid>
                    <Separator Background="#444" Height="1"/>
                    <Button Classes="SheetButton" Command="{Binding ShowDataIODialogCommand}"><StackPanel Orientation="Horizontal" Spacing="12"><TextBlock Text="ðŸ“¡" FontSize="24"/><TextBlock Text="Data I/O" VerticalAlignment="Center" FontSize="16"/></StackPanel></Button>
                    <Button Classes="SheetButton" Command="{Binding ToggleSimulatorPanelCommand}"><StackPanel Orientation="Horizontal" Spacing="12"><TextBlock Text="ðŸšœ" FontSize="24"/><TextBlock Text="Simulator" VerticalAlignment="Center" FontSize="16"/></StackPanel></Button>
                    <Button Classes="SheetButton" Command="{Binding ToggleGridCommand}"><StackPanel Orientation="Horizontal" Spacing="12"><TextBlock Text="ðŸ“Š" FontSize="24"/><TextBlock Text="Toggle Grid" VerticalAlignment="Center" FontSize="16"/></StackPanel></Button>
                </StackPanel>
            </Border>
        </Grid>
    </Grid>
</UserControl>
