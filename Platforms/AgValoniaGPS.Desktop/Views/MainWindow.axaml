<Window xmlns="https://github.com/avaloniaui"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
        xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
        xmlns:vm="using:AgValoniaGPS.ViewModels"
        xmlns:controls="clr-namespace:AgValoniaGPS.Views.Controls;assembly=AgValoniaGPS.Views"
        xmlns:panels="clr-namespace:AgValoniaGPS.Views.Controls.Panels;assembly=AgValoniaGPS.Views"
        xmlns:dialogs="clr-namespace:AgValoniaGPS.Views.Controls.Dialogs;assembly=AgValoniaGPS.Views"
        mc:Ignorable="d" d:DesignWidth="1366" d:DesignHeight="768"
        x:Class="AgValoniaGPS.Desktop.Views.MainWindow"
        x:DataType="vm:MainViewModel"
        Icon="/Assets/avalonia-logo.ico"
        Title="AgValoniaGPS"
        Background="#1a1a1a">

    <Window.Styles>
        <!-- Floating Panel Style -->
        <Style Selector="Border.FloatingPanel">
            <Setter Property="Background" Value="#DD2C3E50"/>
            <Setter Property="CornerRadius" Value="12"/>
            <Setter Property="Padding" Value="15"/>
            <Setter Property="BoxShadow" Value="0 4 16 2 #40000000"/>
        </Style>

        <!-- Modern Button Style -->
        <Style Selector="Button.ModernButton">
            <Setter Property="Background" Value="#3498DB"/>
            <Setter Property="Foreground" Value="White"/>
            <Setter Property="CornerRadius" Value="6"/>
            <Setter Property="Padding" Value="12,6"/>
            <Setter Property="BorderThickness" Value="0"/>
            <Setter Property="Cursor" Value="Hand"/>
        </Style>
        <Style Selector="Button.ModernButton:pointerover">
            <Setter Property="Background" Value="#2980B9"/>
        </Style>
        <Style Selector="Button.ModernButton:pressed">
            <Setter Property="Background" Value="#21618C"/>
        </Style>

        <!-- Toggle On Style - overrides ModernButton when active -->
        <Style Selector="Button.ModernButton.ToggleOn">
            <Setter Property="Background" Value="#1ABC9C"/>
        </Style>
        <Style Selector="Button.ModernButton.ToggleOn:pointerover">
            <Setter Property="Background" Value="#16A085"/>
        </Style>
        <Style Selector="Button.ModernButton.ToggleOn:pressed">
            <Setter Property="Background" Value="#138D75"/>
        </Style>

        <!-- Icon Button Style -->
        <Style Selector="Button.IconButton">
            <Setter Property="Background" Value="#DD34495E"/>
            <Setter Property="Foreground" Value="White"/>
            <Setter Property="CornerRadius" Value="8"/>
            <Setter Property="Width" Value="48"/>
            <Setter Property="Height" Value="48"/>
            <Setter Property="Padding" Value="0"/>
            <Setter Property="BorderThickness" Value="0"/>
            <Setter Property="Cursor" Value="Hand"/>
            <Setter Property="FontSize" Value="20"/>
        </Style>
        <Style Selector="Button.IconButton:pointerover">
            <Setter Property="Background" Value="#DD475A6E"/>
        </Style>

        <!-- Left Panel Button Style (for image-based icons) -->
        <Style Selector="Button.LeftPanelButton">
            <Setter Property="Background" Value="#DD34495E"/>
            <Setter Property="CornerRadius" Value="8"/>
            <Setter Property="Width" Value="64"/>
            <Setter Property="Height" Value="64"/>
            <Setter Property="Padding" Value="8"/>
            <Setter Property="BorderThickness" Value="0"/>
            <Setter Property="Cursor" Value="Hand"/>
        </Style>
        <Style Selector="Button.LeftPanelButton:pointerover">
            <Setter Property="Background" Value="#DD475A6E"/>
        </Style>
        <Style Selector="Button.LeftPanelButton:pressed">
            <Setter Property="Background" Value="#DD3E5872"/>
        </Style>

        <!-- Left Panel Separator -->
        <Style Selector="Separator.LeftPanelSeparator">
            <Setter Property="Background" Value="#444"/>
            <Setter Property="Height" Value="2"/>
            <Setter Property="Margin" Value="8,4"/>
        </Style>

        <!-- Status Indicator Style -->
        <Style Selector="Border.StatusBox">
            <Setter Property="Background" Value="#DD1E2930"/>
            <Setter Property="CornerRadius" Value="8"/>
            <Setter Property="Padding" Value="10"/>
        </Style>
    </Window.Styles>

    <!-- Main content with dialog overlays -->
    <Panel>
    <!-- Main Grid with OpenGL as background -->
    <Grid>
        <!-- Map Render Area (fills entire window) with pointer events -->
        <!-- Platform-specific map control is created at runtime in code-behind -->
        <ContentControl x:Name="MapControlContainer" ZIndex="0"
                        PointerPressed="MapOverlay_PointerPressed"
                        PointerMoved="MapOverlay_PointerMoved"
                        PointerReleased="MapOverlay_PointerReleased"
                        PointerWheelChanged="MapOverlay_PointerWheelChanged" />

        <!-- TOP STATUS BAR: RTK Status -->
        <Border Classes="FloatingPanel"
                ZIndex="10"
                Margin="20"
                HorizontalAlignment="Left"
                VerticalAlignment="Top"
                IsHitTestVisible="True">
            <StackPanel Orientation="Horizontal" Spacing="10">
                <TextBlock Text="RTK Status" Foreground="#3498DB" FontSize="14" FontWeight="Bold"/>
                <Ellipse Width="12" Height="12"
                         Fill="{Binding FixQuality, Converter={StaticResource FixQualityToColorConverter}}"/>
                <TextBlock Text="{Binding FixQuality}" Foreground="White" FontSize="14" FontWeight="Bold"/>
            </StackPanel>
        </Border>

        <!-- Draggable Navigation Panels (using Canvas for absolute positioning) -->
        <Canvas ZIndex="10">
            <!-- LEFT SIDEBAR: Main Navigation Panel (Draggable & Rotatable) -->
            <panels:LeftNavigationPanel x:Name="LeftNavPanel"
                                        Canvas.Left="20" Canvas.Top="100"
                                        DataContext="{Binding}"/>

            <!-- RIGHT SIDEBAR: Guidance Control Panel (Draggable & Rotatable) -->
            <panels:RightNavigationPanel x:Name="RightNavPanel"
                                         Canvas.Right="20" Canvas.Top="100"
                                         DataContext="{Binding}"/>
        </Canvas>

        <!-- BOTTOM BAR: AB Line Guidance Panel (positioned from bottom) -->
        <panels:BottomNavigationPanel x:Name="BottomNavPanel"
                                      HorizontalAlignment="Left"
                                      VerticalAlignment="Bottom"
                                      Margin="20,0,0,20"
                                      ZIndex="10"/>

        <!-- Draggable Section Control (using Canvas for absolute positioning) -->
        <Canvas>
            <panels:SectionControlPanel x:Name="SectionControlPanel"
                                        ZIndex="10"
                                        Canvas.Left="900" Canvas.Top="600"
                                        Cursor="Hand"
                                        PointerPressed="SectionControl_PointerPressed"
                                        PointerMoved="SectionControl_PointerMoved"
                                        PointerReleased="SectionControl_PointerReleased"/>
        </Canvas>
    </Grid>

    <!-- AB Creation Instruction Banner -->
    <Border Background="#CC000000" CornerRadius="8" Padding="16,8"
            HorizontalAlignment="Center" VerticalAlignment="Top" Margin="0,80,0,0"
            IsVisible="{Binding IsCreatingABLine}">
        <StackPanel Orientation="Horizontal" Spacing="16">
            <TextBlock Text="{Binding ABCreationInstructions}"
                       Foreground="White" FontSize="16" VerticalAlignment="Center"/>
            <Button Content="Cancel"
                    Command="{Binding CancelABCreationCommand}"
                    Background="#DD3333" Foreground="White"
                    Padding="12,4"/>
        </StackPanel>
    </Border>

    <!-- Modal Dialog Overlays (rendered on top of everything) -->
    <dialogs:SimCoordsDialogPanel/>
    <dialogs:FieldSelectionDialogPanel/>
    <dialogs:NewFieldDialogPanel/>
    <dialogs:FromExistingFieldDialogPanel/>
    <dialogs:KmlImportDialogPanel/>
    <dialogs:IsoXmlImportDialogPanel/>
    <dialogs:BoundaryMapDialogPanel/>
    <dialogs:NumericInputDialogPanel/>
    <dialogs:AgShareSettingsDialogPanel/>
    <dialogs:AgShareUploadDialogPanel/>
    <dialogs:AgShareDownloadDialogPanel/>
    <dialogs:DataIODialogPanel/>
    <dialogs:HeadlandBuilderDialogPanel/>
    <dialogs:HeadlandDialogPanel/>
    <dialogs:QuickABSelectorPanel/>
    <dialogs:TracksDialogPanel/>
    <dialogs:DrawABDialogPanel/>
    <dialogs:ConfigurationDialog x:Name="ConfigDialog"
                                 DataContext="{Binding ConfigurationViewModel}"/>
    </Panel>
</Window>
