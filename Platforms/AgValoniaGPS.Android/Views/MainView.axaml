<UserControl xmlns="https://github.com/avaloniaui"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
        xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
        xmlns:vm="clr-namespace:AgValoniaGPS.ViewModels;assembly=AgValoniaGPS.ViewModels"
        xmlns:controls="clr-namespace:AgValoniaGPS.Views.Controls;assembly=AgValoniaGPS.Views"
        xmlns:panels="clr-namespace:AgValoniaGPS.Views.Controls.Panels;assembly=AgValoniaGPS.Views"
        xmlns:dialogs="clr-namespace:AgValoniaGPS.Views.Controls.Dialogs;assembly=AgValoniaGPS.Views"
        mc:Ignorable="d" d:DesignWidth="800" d:DesignHeight="600"
        x:Class="AgValoniaGPS.Android.Views.MainView"
        x:DataType="vm:MainViewModel"
        Background="#1a1a1a">

    <!-- Android Main View with ViewModel -->
    <Panel>
        <!-- Main Content -->
        <Grid RowDefinitions="Auto,*">

            <!-- Top Status Bar -->
            <Border Grid.Row="0" Background="#2d2d2d" Padding="10">
                <Grid ColumnDefinitions="Auto,*,Auto">
                    <!-- Left: Status and GPS info - use MinWidth to prevent layout shifts -->
                    <StackPanel Grid.Column="0" Orientation="Horizontal" Spacing="15">
                        <TextBlock Text="{Binding StatusMessage}" Foreground="#2ECC71" FontSize="14"
                                   TextTrimming="CharacterEllipsis" Width="180"/>
                        <TextBlock Text="{Binding State.Vehicle.FixQualityText}" Foreground="#3498DB" FontSize="12"
                                   MinWidth="70"/>
                        <TextBlock Text="{Binding CurrentFps, StringFormat='FPS: {0:F0}'}" Foreground="#F1C40F" FontSize="12"
                                   MinWidth="55"/>
                        <TextBlock Text="{Binding GpsToPgnLatencyMs, StringFormat='Lat: {0:F1}ms'}" Foreground="#F39C12" FontSize="12"
                                   MinWidth="75"/>
                    </StackPanel>

                    <!-- Right: Field Statistics (when field is active) -->
                    <StackPanel Grid.Column="2" Orientation="Horizontal" Spacing="10"
                                IsVisible="{Binding HasActiveField}">
                        <TextBlock Text="{Binding BoundaryAreaDisplay}" Foreground="White" FontSize="12" MinWidth="60"/>
                        <TextBlock Text="|" Foreground="#555" FontSize="12"/>
                        <TextBlock Text="{Binding WorkedAreaDisplay}" Foreground="#2ECC71" FontSize="12" FontWeight="Bold" MinWidth="60"/>
                        <TextBlock Text="|" Foreground="#555" FontSize="12"/>
                        <TextBlock Text="{Binding RemainingPercent, StringFormat='{}{0:F0}%'}" Foreground="#F39C12" FontSize="12" MinWidth="35"/>
                        <TextBlock Text="|" Foreground="#555" FontSize="12"/>
                        <TextBlock Text="{Binding WorkRateDisplay}" Foreground="#3498DB" FontSize="12" MinWidth="65"/>
                    </StackPanel>
                </Grid>
            </Border>

            <!-- Main Content Area - Cross-platform DrawingContext Map with overlay panels -->
            <Grid Grid.Row="1">
                <controls:DrawingContextMapControl x:Name="MapControl" Margin="5"
                                                   IsGridVisible="{Binding IsGridOn}"/>

                <!-- All Draggable Panels in single Canvas (must be in same Canvas for consistent drag bounds) -->
                <Canvas ZIndex="10">
                    <!-- Left Navigation Panel (Draggable & Rotatable) -->
                    <panels:LeftNavigationPanel x:Name="LeftNavPanel"
                                                Canvas.Left="20" Canvas.Top="50"
                                                DataContext="{Binding}"/>

                    <!-- Right Navigation Panel (Draggable & Rotatable) -->
                    <panels:RightNavigationPanel x:Name="RightNavPanel"
                                                 Canvas.Left="600" Canvas.Top="50"
                                                 DataContext="{Binding}"/>

                    <!-- Section Control Panel (Draggable) -->
                    <panels:SectionControlPanel x:Name="SectionControlPanel"
                                                Canvas.Left="200" Canvas.Top="500"
                                                Cursor="Hand"
                                                DataContext="{Binding}"
                                                PointerPressed="SectionControl_PointerPressed"
                                                PointerMoved="SectionControl_PointerMoved"
                                                PointerReleased="SectionControl_PointerReleased"/>

                    <!-- Bottom Navigation Panel (Draggable & Rotatable) -->
                    <panels:BottomNavigationPanel x:Name="BottomNavPanel"
                                                  Canvas.Left="200" Canvas.Top="420"
                                                  DataContext="{Binding}"/>
                </Canvas>

                <!-- Zoom Controls - Bottom Right -->
                <StackPanel HorizontalAlignment="Right" VerticalAlignment="Bottom"
                            Margin="0,0,20,20" Spacing="10">
                    <Button Content="+" Command="{Binding ZoomInCommand}"
                            Width="50" Height="50" FontSize="28" FontWeight="Bold"
                            HorizontalContentAlignment="Center" VerticalContentAlignment="Center"
                            Background="#4A5568" Foreground="White" CornerRadius="8"/>
                    <Button Content="-" Command="{Binding ZoomOutCommand}"
                            Width="50" Height="50" FontSize="28" FontWeight="Bold"
                            HorizontalContentAlignment="Center" VerticalContentAlignment="Center"
                            Background="#4A5568" Foreground="White" CornerRadius="8"/>
                </StackPanel>
            </Grid>
        </Grid>

        <!-- AB Creation Instruction Banner -->
        <Border Background="#CC000000" CornerRadius="8" Padding="16,8"
                HorizontalAlignment="Center" VerticalAlignment="Top" Margin="0,80,0,0"
                IsVisible="{Binding IsCreatingABLine}">
            <StackPanel Orientation="Horizontal" Spacing="16">
                <TextBlock Text="{Binding ABCreationInstructions}"
                           Foreground="White" FontSize="16" VerticalAlignment="Center"/>
                <Button Content="Cancel"
                        Command="{Binding CancelABCreationCommand}"
                        Background="#DD3333" Foreground="White"
                        Padding="12,4"/>
            </StackPanel>
        </Border>

        <!-- Modal Dialog Overlays (shared across platforms) -->
        <controls:DialogOverlayHost DataContext="{Binding}"/>
    </Panel>
</UserControl>
