<UserControl xmlns="https://github.com/avaloniaui"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
             xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
             xmlns:vm="using:AgValoniaGPS.ViewModels"
             xmlns:controls="using:AgValoniaGPS.Views.Controls"
             mc:Ignorable="d" d:DesignWidth="800" d:DesignHeight="900"
             x:Class="AgValoniaGPS.Views.Controls.Dialogs.DataIODialogPanel"
             x:DataType="vm:MainViewModel"
             IsVisible="{Binding IsDataIODialogVisible}"
             IsHitTestVisible="{Binding IsDataIODialogVisible}">

    <UserControl.Styles>
        <!-- Modern Panel Style -->
        <Style Selector="Border.Panel">
            <Setter Property="Background" Value="#34495E"/>
            <Setter Property="CornerRadius" Value="8"/>
            <Setter Property="Padding" Value="15"/>
            <Setter Property="Margin" Value="0,0,0,15"/>
        </Style>

        <!-- Modern Button Style -->
        <Style Selector="Button.ModernButton">
            <Setter Property="Background" Value="#3498DB"/>
            <Setter Property="Foreground" Value="White"/>
            <Setter Property="CornerRadius" Value="6"/>
            <Setter Property="Padding" Value="12,6"/>
            <Setter Property="BorderThickness" Value="0"/>
            <Setter Property="Cursor" Value="Hand"/>
            <Setter Property="MinHeight" Value="44"/>
        </Style>
        <Style Selector="Button.ModernButton:pointerover">
            <Setter Property="Background" Value="#2980B9"/>
        </Style>
        <Style Selector="Button.ModernButton:pressed">
            <Setter Property="Background" Value="#21618C"/>
        </Style>

        <!-- Input Field Button Style (tappable fields that show keyboard) -->
        <Style Selector="Button.DataIOInput">
            <Setter Property="Background" Value="#1E2930"/>
            <Setter Property="Foreground" Value="White"/>
            <Setter Property="BorderBrush" Value="#4A5F73"/>
            <Setter Property="BorderThickness" Value="1"/>
            <Setter Property="CornerRadius" Value="4"/>
            <Setter Property="Padding" Value="8,6"/>
            <Setter Property="MinHeight" Value="40"/>
            <Setter Property="HorizontalAlignment" Value="Stretch"/>
            <Setter Property="Cursor" Value="Hand"/>
        </Style>
        <Style Selector="Button.DataIOInput:pointerover">
            <Setter Property="Background" Value="#2A3940"/>
        </Style>
        <Style Selector="Button.DataIOInput:pressed">
            <Setter Property="Background" Value="#3A4950"/>
        </Style>

        <!-- Label Style -->
        <Style Selector="TextBlock.Label">
            <Setter Property="Foreground" Value="#BDC3C7"/>
            <Setter Property="FontSize" Value="14"/>
        </Style>

        <!-- Header Style -->
        <Style Selector="TextBlock.Header">
            <Setter Property="Foreground" Value="#3498DB"/>
            <Setter Property="FontSize" Value="16"/>
            <Setter Property="FontWeight" Value="Bold"/>
            <Setter Property="Margin" Value="0,0,0,10"/>
        </Style>
    </UserControl.Styles>

    <Grid>
        <!-- Backdrop - clicking closes the dialog -->
        <Button Background="#80000000"
                Command="{Binding CloseDataIODialogCommand}"
                HorizontalAlignment="Stretch" VerticalAlignment="Stretch"
                BorderThickness="0" CornerRadius="0"/>

        <!-- Dialog Content -->
        <Border Background="#2C3E50" CornerRadius="12" Padding="0"
                MinWidth="500" MaxWidth="800"
                Margin="20,40,20,40"
                HorizontalAlignment="Center" VerticalAlignment="Stretch"
                BoxShadow="0 8 32 0 #80000000">

            <Grid RowDefinitions="Auto,*,Auto">
                <!-- Header -->
                <Border Grid.Row="0" Background="#34495E" CornerRadius="12,12,0,0" Padding="20,15">
                    <Grid ColumnDefinitions="*,Auto">
                        <StackPanel>
                            <TextBlock Text="Data I/O Configuration" Foreground="White" FontSize="20" FontWeight="Bold"/>
                            <TextBlock Text="Network, NTRIP, and GPS settings" Foreground="#BDC3C7" FontSize="13" Margin="0,5,0,0"/>
                        </StackPanel>
                        <Button Grid.Column="1" Background="Transparent" BorderThickness="0"
                                Command="{Binding CloseDataIODialogCommand}" Cursor="Hand" VerticalAlignment="Top">
                            <TextBlock Text="✕" Foreground="#BDC3C7" FontSize="20"/>
                        </Button>
                    </Grid>
                </Border>

                <!-- Scrollable Content -->
                <ScrollViewer Grid.Row="1" Padding="20">
                    <StackPanel Spacing="15" Margin="0,0,0,60">

                        <!-- UDP Communication Section -->
                        <Border Classes="Panel">
                            <StackPanel Spacing="10">
                                <TextBlock Classes="Header" Text="UDP Communication"/>

                                <Grid ColumnDefinitions="140,*">
                                    <TextBlock Classes="Label" Text="Network Status:" VerticalAlignment="Center"/>
                                    <TextBlock Grid.Column="1" Text="{Binding NetworkStatus}" Foreground="White" VerticalAlignment="Center"/>
                                </Grid>
                            </StackPanel>
                        </Border>

                        <!-- Module Connections Section -->
                        <Border Classes="Panel">
                            <StackPanel Spacing="10">
                                <TextBlock Classes="Header" Text="Module Connections"/>

                                <Grid ColumnDefinitions="140,Auto,*" RowDefinitions="Auto,Auto,Auto">
                                    <!-- AutoSteer -->
                                    <TextBlock Classes="Label" Text="AutoSteer:" VerticalAlignment="Center"/>
                                    <Ellipse Grid.Column="1" Width="12" Height="12" Margin="0,0,10,0"
                                             Fill="{Binding IsAutoSteerDataOk, Converter={StaticResource BoolToColorConverter}}"/>
                                    <TextBlock Grid.Column="2"
                                               Text="{Binding IsAutoSteerDataOk, Converter={StaticResource BoolToStatusConverter}}"
                                               Foreground="White" VerticalAlignment="Center"/>

                                    <!-- Machine -->
                                    <TextBlock Grid.Row="1" Classes="Label" Text="Machine:" VerticalAlignment="Center" Margin="0,8,0,0"/>
                                    <Ellipse Grid.Row="1" Grid.Column="1" Width="12" Height="12" Margin="0,8,10,0"
                                             Fill="{Binding IsMachineDataOk, Converter={StaticResource BoolToColorConverter}}"/>
                                    <TextBlock Grid.Row="1" Grid.Column="2" Margin="0,8,0,0"
                                               Text="{Binding IsMachineDataOk, Converter={StaticResource BoolToStatusConverter}}"
                                               Foreground="White" VerticalAlignment="Center"/>

                                    <!-- IMU -->
                                    <TextBlock Grid.Row="2" Classes="Label" Text="IMU:" VerticalAlignment="Center" Margin="0,8,0,0"/>
                                    <Ellipse Grid.Row="2" Grid.Column="1" Width="12" Height="12" Margin="0,8,10,0"
                                             Fill="{Binding IsImuDataOk, Converter={StaticResource BoolToColorConverter}}"/>
                                    <TextBlock Grid.Row="2" Grid.Column="2" Margin="0,8,0,0"
                                               Text="{Binding IsImuDataOk, Converter={StaticResource BoolToStatusConverter}}"
                                               Foreground="White" VerticalAlignment="Center"/>
                                </Grid>
                            </StackPanel>
                        </Border>

                        <!-- NTRIP Configuration Section -->
                        <Border Classes="Panel">
                            <StackPanel Spacing="12">
                                <TextBlock Classes="Header" Text="RTK Corrections (NTRIP)"/>

                                <!-- Caster and Port -->
                                <Grid ColumnDefinitions="*,100" RowDefinitions="Auto,Auto">
                                    <StackPanel>
                                        <TextBlock Classes="Label" Text="Caster Address" Margin="0,0,0,4"/>
                                        <Button Classes="DataIOInput" HorizontalContentAlignment="Left"
                                                Command="{Binding SetActiveDataIOFieldCommand}"
                                                CommandParameter="CasterAddress">
                                            <TextBlock Text="{Binding NtripCasterAddress}" Foreground="White"/>
                                        </Button>
                                    </StackPanel>
                                    <StackPanel Grid.Column="1" Margin="10,0,0,0">
                                        <TextBlock Classes="Label" Text="Port" Margin="0,0,0,4"/>
                                        <Button Classes="DataIOInput" HorizontalContentAlignment="Left"
                                                Command="{Binding SetActiveDataIOFieldCommand}"
                                                CommandParameter="CasterPort">
                                            <TextBlock Text="{Binding NtripCasterPort}" Foreground="White"/>
                                        </Button>
                                    </StackPanel>
                                </Grid>

                                <!-- Mount Point -->
                                <StackPanel>
                                    <TextBlock Classes="Label" Text="Mount Point" Margin="0,0,0,4"/>
                                    <Button Classes="DataIOInput" HorizontalContentAlignment="Left"
                                            Command="{Binding SetActiveDataIOFieldCommand}"
                                            CommandParameter="MountPoint">
                                        <TextBlock Text="{Binding NtripMountPoint}" Foreground="White"/>
                                    </Button>
                                </StackPanel>

                                <!-- Username -->
                                <StackPanel>
                                    <TextBlock Classes="Label" Text="Username" Margin="0,0,0,4"/>
                                    <Button Classes="DataIOInput" HorizontalContentAlignment="Left"
                                            Command="{Binding SetActiveDataIOFieldCommand}"
                                            CommandParameter="Username">
                                        <TextBlock Text="{Binding NtripUsername}" Foreground="White"/>
                                    </Button>
                                </StackPanel>

                                <!-- Password -->
                                <StackPanel>
                                    <TextBlock Classes="Label" Text="Password" Margin="0,0,0,4"/>
                                    <Button Classes="DataIOInput" HorizontalContentAlignment="Left"
                                            Command="{Binding SetActiveDataIOFieldCommand}"
                                            CommandParameter="Password">
                                        <TextBlock Text="{Binding NtripPassword}" Foreground="White"/>
                                    </Button>
                                </StackPanel>

                                <!-- Connect/Disconnect Buttons -->
                                <Grid ColumnDefinitions="*,*" Margin="0,5,0,0">
                                    <Button Classes="ModernButton" Content="Connect"
                                            Command="{Binding ConnectToNtripCommand}" Margin="0,0,5,0"/>
                                    <Button Grid.Column="1" Classes="ModernButton" Content="Disconnect"
                                            Command="{Binding DisconnectFromNtripCommand}" Margin="5,0,0,0"
                                            Background="#E67E22"/>
                                </Grid>

                                <Separator Background="#4A5F73" Height="1" Margin="0,5"/>

                                <!-- NTRIP Status -->
                                <Grid ColumnDefinitions="Auto,Auto,*">
                                    <TextBlock Classes="Label" Text="Status:" VerticalAlignment="Center" Margin="0,0,10,0"/>
                                    <Ellipse Grid.Column="1" Width="12" Height="12" Margin="0,0,8,0"
                                             Fill="{Binding IsNtripConnected, Converter={StaticResource BoolToColorConverter}}"/>
                                    <TextBlock Grid.Column="2" Text="{Binding NtripStatus}" Foreground="White" VerticalAlignment="Center" TextWrapping="Wrap"/>
                                </Grid>

                                <Grid ColumnDefinitions="Auto,*">
                                    <TextBlock Classes="Label" Text="RTCM Received:" VerticalAlignment="Center" Margin="0,0,10,0"/>
                                    <TextBlock Grid.Column="1" Text="{Binding NtripBytesReceived}" Foreground="White" VerticalAlignment="Center"/>
                                </Grid>
                            </StackPanel>
                        </Border>

                        <!-- GPS Data Section -->
                        <Border Classes="Panel">
                            <StackPanel Spacing="8">
                                <TextBlock Classes="Header" Text="GPS Data"/>

                                <Grid ColumnDefinitions="140,*" RowDefinitions="Auto,Auto,Auto,Auto,Auto,Auto">
                                    <TextBlock Classes="Label" Text="Status:"/>
                                    <TextBlock Grid.Column="1" Text="{Binding StatusMessage}" Foreground="White"/>

                                    <TextBlock Grid.Row="1" Classes="Label" Text="Fix Quality:" Margin="0,6,0,0"/>
                                    <TextBlock Grid.Row="1" Grid.Column="1" Text="{Binding FixQuality}" Foreground="White" Margin="0,6,0,0"/>

                                    <TextBlock Grid.Row="2" Classes="Label" Text="Satellites:" Margin="0,6,0,0"/>
                                    <TextBlock Grid.Row="2" Grid.Column="1" Text="{Binding SatelliteCount}" Foreground="White" Margin="0,6,0,0"/>

                                    <TextBlock Grid.Row="3" Classes="Label" Text="Latitude:" Margin="0,6,0,0"/>
                                    <TextBlock Grid.Row="3" Grid.Column="1" Text="{Binding Latitude, StringFormat='{}{0:F6}°'}" Foreground="White" Margin="0,6,0,0"/>

                                    <TextBlock Grid.Row="4" Classes="Label" Text="Longitude:" Margin="0,6,0,0"/>
                                    <TextBlock Grid.Row="4" Grid.Column="1" Text="{Binding Longitude, StringFormat='{}{0:F6}°'}" Foreground="White" Margin="0,6,0,0"/>

                                    <TextBlock Grid.Row="5" Classes="Label" Text="Speed:" Margin="0,6,0,0"/>
                                    <TextBlock Grid.Row="5" Grid.Column="1" Text="{Binding Speed, StringFormat='{}{0:F2} m/s'}" Foreground="White" Margin="0,6,0,0"/>
                                </Grid>
                            </StackPanel>
                        </Border>
                    </StackPanel>
                </ScrollViewer>

                <!-- Footer with Keyboard and Buttons -->
                <Border Grid.Row="2" Background="#34495E" CornerRadius="0,0,12,12" Padding="15">
                    <StackPanel Spacing="10">
                        <!-- Alphanumeric Keyboard -->
                        <controls:AlphanumericKeyboardPanel IsVisible="{Binding IsDataIOKeyboardVisible}"
                                                            Text="{Binding DataIOKeyboardText, Mode=TwoWay}"/>

                        <!-- Button Row -->
                        <Grid ColumnDefinitions="*,*">
                            <Button Classes="ModernButton" Content="Save Settings"
                                    Command="{Binding SaveNtripSettingsCommand}"
                                    HorizontalAlignment="Stretch" Background="#3498DB" Margin="0,0,5,0"/>
                            <Button Grid.Column="1" Classes="ModernButton" Content="Close"
                                    Command="{Binding CloseDataIODialogCommand}"
                                    HorizontalAlignment="Stretch" Background="#27AE60" Margin="5,0,0,0"/>
                        </Grid>
                    </StackPanel>
                </Border>
            </Grid>
        </Border>
    </Grid>
</UserControl>
