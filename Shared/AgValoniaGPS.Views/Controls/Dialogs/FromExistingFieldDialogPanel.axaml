<!--
AgValoniaGPS
Copyright (C) 2024-2025 AgValoniaGPS Contributors

This program is free software: you can redistribute it and/or modify
it under the terms of the GNU General Public License as published by
the Free Software Foundation, either version 3 of the License, or
(at your option) any later version.

This program is distributed in the hope that it will be useful,
but WITHOUT ANY WARRANTY; without even the implied warranty of
MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the
GNU General Public License for more details.

You should have received a copy of the GNU General Public License
along with this program. If not, see <https://www.gnu.org/licenses/>.
-->
<UserControl xmlns="https://github.com/avaloniaui"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
             xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
             xmlns:vm="using:AgValoniaGPS.ViewModels"
             mc:Ignorable="d" d:DesignWidth="800" d:DesignHeight="600"
             x:Class="AgValoniaGPS.Views.Controls.Dialogs.FromExistingFieldDialogPanel"
             x:DataType="vm:MainViewModel"
             IsVisible="{Binding State.UI.IsFromExistingFieldDialogVisible}"
             IsHitTestVisible="{Binding State.UI.IsFromExistingFieldDialogVisible}">

    <UserControl.Styles>
        <Style Selector="TextBlock.Header">
            <Setter Property="Foreground" Value="#3498DB"/>
            <Setter Property="FontSize" Value="20"/>
            <Setter Property="FontWeight" Value="Bold"/>
            <Setter Property="Margin" Value="0,0,0,12"/>
        </Style>
        <Style Selector="Button.DialogButton">
            <Setter Property="Background" Value="#3498DB"/>
            <Setter Property="Foreground" Value="White"/>
            <Setter Property="BorderThickness" Value="0"/>
            <Setter Property="Padding" Value="16,10"/>
            <Setter Property="FontSize" Value="14"/>
            <Setter Property="FontWeight" Value="SemiBold"/>
            <Setter Property="Cursor" Value="Hand"/>
            <Setter Property="CornerRadius" Value="6"/>
        </Style>
        <Style Selector="Button.DialogButton:pointerover">
            <Setter Property="Background" Value="#2980B9"/>
        </Style>
        <Style Selector="Button.CancelButton">
            <Setter Property="Background" Value="#C0392B"/>
        </Style>
        <Style Selector="Button.CancelButton:pointerover">
            <Setter Property="Background" Value="#E74C3C"/>
        </Style>
        <Style Selector="Button.OkButton">
            <Setter Property="Background" Value="#27AE60"/>
        </Style>
        <Style Selector="Button.OkButton:pointerover">
            <Setter Property="Background" Value="#2ECC71"/>
        </Style>
        <Style Selector="Button.ToolButton">
            <Setter Property="Background" Value="#34495E"/>
            <Setter Property="Foreground" Value="White"/>
            <Setter Property="CornerRadius" Value="6"/>
            <Setter Property="Padding" Value="8"/>
            <Setter Property="MinWidth" Value="50"/>
            <Setter Property="MinHeight" Value="50"/>
            <Setter Property="BorderThickness" Value="0"/>
        </Style>
        <Style Selector="Button.ToolButton:pointerover">
            <Setter Property="Background" Value="#4A6278"/>
        </Style>
        <Style Selector="Button.ToolButton:pressed">
            <Setter Property="Background" Value="#1ABC9C"/>
        </Style>
        <Style Selector="Button.ToggleOn">
            <Setter Property="Background" Value="#27AE60"/>
        </Style>
        <Style Selector="Button.ToggleOn:pointerover">
            <Setter Property="Background" Value="#2ECC71"/>
        </Style>
        <Style Selector="ListBox">
            <Setter Property="Background" Value="#1E2930"/>
            <Setter Property="BorderBrush" Value="#4A5F73"/>
            <Setter Property="BorderThickness" Value="1"/>
            <Setter Property="CornerRadius" Value="4"/>
        </Style>
        <Style Selector="ListBoxItem">
            <Setter Property="Padding" Value="12,10"/>
            <Setter Property="Margin" Value="2"/>
            <Setter Property="CornerRadius" Value="4"/>
        </Style>
        <Style Selector="ListBoxItem:pointerover">
            <Setter Property="Background" Value="#2C3E50"/>
        </Style>
        <Style Selector="ListBoxItem:selected">
            <Setter Property="Background" Value="#3498DB"/>
        </Style>

        <Style Selector="TextBox.DialogInput">
            <Setter Property="Background" Value="#34495E"/>
            <Setter Property="Foreground" Value="White"/>
            <Setter Property="BorderBrush" Value="#7F8C8D"/>
            <Setter Property="CornerRadius" Value="6"/>
            <Setter Property="Padding" Value="12,10"/>
            <Setter Property="FontSize" Value="16"/>
            <Setter Property="CaretBrush" Value="White"/>
        </Style>
        <Style Selector="TextBox.DialogInput:focus">
            <Setter Property="Background" Value="#34495E"/>
            <Setter Property="Foreground" Value="White"/>
            <Setter Property="BorderBrush" Value="#3498DB"/>
        </Style>
        <Style Selector="TextBox.DialogInput:pointerover">
            <Setter Property="Background" Value="#34495E"/>
            <Setter Property="Foreground" Value="White"/>
        </Style>
        <Style Selector="TextBox.DialogInput /template/ TextBlock">
            <Setter Property="Foreground" Value="White"/>
        </Style>
        <Style Selector="TextBox.DialogInput:focus /template/ Border#PART_BorderElement">
            <Setter Property="Background" Value="#34495E"/>
        </Style>
    </UserControl.Styles>

    <Grid>
        <!-- Semi-transparent backdrop -->
        <Border Background="#80000000" PointerPressed="Backdrop_PointerPressed"/>

        <!-- Dialog panel -->
        <Border Background="#2C3E50"
                CornerRadius="12"
                MaxWidth="650"
                MaxHeight="550"
                Margin="20"
                HorizontalAlignment="Center"
                VerticalAlignment="Center"
                BoxShadow="0 8 32 #40000000">
            <Grid RowDefinitions="Auto,Auto,*,Auto,Auto,Auto" Margin="20">
                <!-- Header -->
                <TextBlock Grid.Row="0" Classes="Header" Text="Create Field From Existing"/>

                <!-- Column Headers -->
                <Border Grid.Row="1" Background="#34495E" CornerRadius="4,4,0,0" Padding="12,8">
                    <Grid ColumnDefinitions="*,80,80">
                        <TextBlock Grid.Column="0" Text="Field Name" Foreground="#E74C3C" FontWeight="Bold" FontSize="14"/>
                        <TextBlock Grid.Column="1" Text="Distance" Foreground="#E74C3C" FontWeight="Bold" FontSize="14" TextAlignment="Right"/>
                        <TextBlock Grid.Column="2" Text="Area (ha)" Foreground="#E74C3C" FontWeight="Bold" FontSize="14" TextAlignment="Right"/>
                    </Grid>
                </Border>

                <!-- Fields ListBox -->
                <ListBox Grid.Row="2"
                         SelectionMode="Single"
                         MinHeight="150"
                         MaxHeight="200"
                         ItemsSource="{Binding AvailableFields}"
                         SelectedItem="{Binding FromExistingSelectedField}">
                    <ListBox.ItemTemplate>
                        <DataTemplate>
                            <Grid ColumnDefinitions="*,80,80">
                                <TextBlock Grid.Column="0" Text="{Binding Name}" Foreground="White" FontSize="14"/>
                                <TextBlock Grid.Column="1" Text="{Binding Distance, StringFormat='{}{0:F1}'}" Foreground="#BDC3C7" TextAlignment="Right" FontSize="14"/>
                                <TextBlock Grid.Column="2" Text="{Binding Area, StringFormat='{}{0:F1}'}" Foreground="#BDC3C7" TextAlignment="Right" FontSize="14"/>
                            </Grid>
                        </DataTemplate>
                    </ListBox.ItemTemplate>
                </ListBox>

                <!-- Name input row -->
                <StackPanel Grid.Row="3" Margin="0,12,0,0" Spacing="6">
                    <TextBlock Text="New Field Name:" Foreground="#BDC3C7" FontSize="13"/>
                    <Grid ColumnDefinitions="*,Auto">
                        <TextBox Grid.Column="0"
                                 Classes="DialogInput"
                                 Text="{Binding FromExistingFieldName, Mode=TwoWay}"
                                 Watermark="Enter new field name"/>
                        <Button Grid.Column="1" Classes="ToolButton" Width="44" Height="40" Margin="8,0,0,0"
                                Command="{Binding BackspaceFieldNameCommand}" ToolTip.Tip="Backspace">
                            <Image Source="avares://AgValoniaGPS.Views/Assets/Icons/BackSpace.png" Width="24" Height="24"/>
                        </Button>
                    </Grid>
                </StackPanel>

                <!-- Append buttons and copy toggles -->
                <Grid Grid.Row="4" ColumnDefinitions="Auto,Auto,Auto,*,Auto,Auto,Auto,Auto" Margin="0,12,0,0">
                    <!-- Name append buttons -->
                    <StackPanel Grid.Column="0" Orientation="Horizontal">
                        <TextBlock Text="+" Foreground="White" FontSize="18" VerticalAlignment="Center" Margin="0,0,4,0"/>
                        <Button Classes="ToolButton" Width="48" Height="48"
                                Command="{Binding AppendVehicleNameCommand}" ToolTip.Tip="Append vehicle name">
                            <Image Source="avares://AgValoniaGPS.Views/Assets/Icons/vehiclePageTractor.png" Width="32" Height="32"/>
                        </Button>
                    </StackPanel>

                    <StackPanel Grid.Column="1" Orientation="Horizontal" Margin="4,0,0,0">
                        <TextBlock Text="+" Foreground="White" FontSize="18" VerticalAlignment="Center" Margin="0,0,4,0"/>
                        <Button Classes="ToolButton" Width="48" Height="48"
                                Command="{Binding AppendDateCommand}" ToolTip.Tip="Append date">
                            <Image Source="avares://AgValoniaGPS.Views/Assets/Icons/JobNameCalendar.png" Width="32" Height="32"/>
                        </Button>
                    </StackPanel>

                    <StackPanel Grid.Column="2" Orientation="Horizontal" Margin="4,0,0,0">
                        <TextBlock Text="+" Foreground="White" FontSize="18" VerticalAlignment="Center" Margin="0,0,4,0"/>
                        <Button Classes="ToolButton" Width="48" Height="48"
                                Command="{Binding AppendTimeCommand}" ToolTip.Tip="Append time">
                            <Image Source="avares://AgValoniaGPS.Views/Assets/Icons/JobNameTime.png" Width="32" Height="32"/>
                        </Button>
                    </StackPanel>

                    <!-- Spacer -->
                    <Border Grid.Column="3"/>

                    <!-- Copy toggles -->
                    <Button Grid.Column="4" Classes="ToolButton" Width="60" Height="48" Margin="4,0"
                            Classes.ToggleOn="{Binding CopyFlags}"
                            Command="{Binding ToggleCopyFlagsCommand}" ToolTip.Tip="Include Flags">
                        <StackPanel HorizontalAlignment="Center" Spacing="2">
                            <Image Source="avares://AgValoniaGPS.Views/Assets/Icons/FlagRed.png" Width="24" Height="24"/>
                            <TextBlock Text="Flags" Foreground="White" FontSize="10" HorizontalAlignment="Center"/>
                        </StackPanel>
                    </Button>

                    <Button Grid.Column="5" Classes="ToolButton" Width="60" Height="48" Margin="4,0"
                            Classes.ToggleOn="{Binding CopyMapping}"
                            Command="{Binding ToggleCopyMappingCommand}" ToolTip.Tip="Include Mapping">
                        <StackPanel HorizontalAlignment="Center" Spacing="2">
                            <Image Source="avares://AgValoniaGPS.Views/Assets/Icons/MappingOn.png" Width="24" Height="24"/>
                            <TextBlock Text="Map" Foreground="White" FontSize="10" HorizontalAlignment="Center"/>
                        </StackPanel>
                    </Button>

                    <Button Grid.Column="6" Classes="ToolButton" Width="60" Height="48" Margin="4,0"
                            Classes.ToggleOn="{Binding CopyHeadland}"
                            Command="{Binding ToggleCopyHeadlandCommand}" ToolTip.Tip="Include Headland">
                        <StackPanel HorizontalAlignment="Center" Spacing="2">
                            <Image Source="avares://AgValoniaGPS.Views/Assets/Icons/HeadlandOn.png" Width="24" Height="24"/>
                            <TextBlock Text="Head" Foreground="White" FontSize="10" HorizontalAlignment="Center"/>
                        </StackPanel>
                    </Button>

                    <Button Grid.Column="7" Classes="ToolButton" Width="60" Height="48" Margin="4,0,0,0"
                            Classes.ToggleOn="{Binding CopyLines}"
                            Command="{Binding ToggleCopyLinesCommand}" ToolTip.Tip="Include AB Lines">
                        <StackPanel HorizontalAlignment="Center" Spacing="2">
                            <Image Source="avares://AgValoniaGPS.Views/Assets/Icons/ABLineCycle.png" Width="24" Height="24"/>
                            <TextBlock Text="Lines" Foreground="White" FontSize="10" HorizontalAlignment="Center"/>
                        </StackPanel>
                    </Button>
                </Grid>

                <!-- Action Buttons -->
                <Grid Grid.Row="5" ColumnDefinitions="*,Auto,Auto" Margin="0,16,0,0">
                    <Border Grid.Column="0"/>
                    <Button Grid.Column="1" Classes="DialogButton CancelButton" Content="Cancel"
                            MinWidth="80" MinHeight="44"
                            Command="{Binding CancelFromExistingFieldDialogCommand}"/>
                    <Button Grid.Column="2" Classes="DialogButton OkButton" Content="Create"
                            MinWidth="80" MinHeight="44" Margin="12,0,0,0"
                            Command="{Binding ConfirmFromExistingFieldDialogCommand}"/>
                </Grid>
            </Grid>
        </Border>
    </Grid>
</UserControl>
