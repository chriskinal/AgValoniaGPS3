<!--
AgValoniaGPS
Copyright (C) 2024-2025 AgValoniaGPS Contributors

This program is free software: you can redistribute it and/or modify
it under the terms of the GNU General Public License as published by
the Free Software Foundation, either version 3 of the License, or
(at your option) any later version.

This program is distributed in the hope that it will be useful,
but WITHOUT ANY WARRANTY; without even the implied warranty of
MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the
GNU General Public License for more details.

You should have received a copy of the GNU General Public License
along with this program. If not, see <https://www.gnu.org/licenses/>.
-->
<UserControl xmlns="https://github.com/avaloniaui"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
             xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
             xmlns:vm="clr-namespace:AgValoniaGPS.ViewModels;assembly=AgValoniaGPS.ViewModels"
             mc:Ignorable="d" d:DesignWidth="400" d:DesignHeight="500"
             x:Class="AgValoniaGPS.Views.Controls.Dialogs.HeadlandBuilderDialogPanel"
             x:DataType="vm:MainViewModel"
             IsVisible="{Binding State.UI.IsHeadlandBuilderDialogVisible}"
             IsHitTestVisible="{Binding State.UI.IsHeadlandBuilderDialogVisible}">

    <!-- Full screen overlay with backdrop -->
    <Grid>
        <!-- Semi-transparent backdrop - clicking dismisses -->
        <Border Background="#80000000" PointerPressed="Backdrop_PointerPressed"/>

        <!-- Centered dialog -->
        <Border Background="#2C3E50" CornerRadius="12" Padding="16"
                HorizontalAlignment="Center" VerticalAlignment="Center"
                MinWidth="320" MaxWidth="400">
            <StackPanel Spacing="12">
                <!-- Title -->
                <TextBlock Text="Headland Builder" FontSize="20" FontWeight="Bold"
                           Foreground="#1ABC9C" HorizontalAlignment="Center"/>

                <!-- Status message if no boundary -->
                <TextBlock Text="No boundary loaded - please create or load a field first"
                           FontSize="14" Foreground="#E74C3C" HorizontalAlignment="Center"
                           TextWrapping="Wrap" TextAlignment="Center"
                           IsVisible="{Binding !HasBoundary}"/>

                <!-- Headland settings (only visible when boundary exists) -->
                <StackPanel Spacing="12" IsVisible="{Binding HasBoundary}">

                    <!-- Distance Setting -->
                    <Border Background="#1a1a1a" CornerRadius="8" Padding="12">
                        <StackPanel Spacing="8">
                            <TextBlock Text="Headland Distance (meters)" Foreground="#AAA" FontSize="12"/>
                            <Grid ColumnDefinitions="*,Auto,Auto">
                                <Border Grid.Column="0" Background="#333" CornerRadius="6" Padding="12,8">
                                    <TextBlock Text="{Binding HeadlandDistance, StringFormat={}{0:F1}}"
                                               FontSize="24" FontWeight="Bold" Foreground="White"
                                               HorizontalAlignment="Center"/>
                                </Border>
                                <StackPanel Grid.Column="1" Margin="8,0,0,0" Spacing="2">
                                    <Button Content="▲" Width="36" Height="28" FontSize="12"
                                            Background="#34495E" Foreground="White" CornerRadius="4"
                                            Command="{Binding IncrementHeadlandDistanceCommand}"/>
                                    <Button Content="▼" Width="36" Height="28" FontSize="12"
                                            Background="#34495E" Foreground="White" CornerRadius="4"
                                            Command="{Binding DecrementHeadlandDistanceCommand}"/>
                                </StackPanel>
                                <Button Grid.Column="2" Content="Tool Width" Width="80" Height="58"
                                        FontSize="11" Background="#2980B9" Foreground="White"
                                        CornerRadius="6" Margin="8,0,0,0"
                                        Command="{Binding SetHeadlandToToolWidthCommand}"
                                        ToolTip.Tip="Set distance to implement width"/>
                            </Grid>
                        </StackPanel>
                    </Border>

                    <!-- Passes Setting -->
                    <Border Background="#1a1a1a" CornerRadius="8" Padding="12">
                        <StackPanel Spacing="8">
                            <TextBlock Text="Number of Passes" Foreground="#AAA" FontSize="12"/>
                            <Grid ColumnDefinitions="*,Auto">
                                <Border Grid.Column="0" Background="#333" CornerRadius="6" Padding="12,8">
                                    <TextBlock Text="{Binding HeadlandPasses}"
                                               FontSize="24" FontWeight="Bold" Foreground="White"
                                               HorizontalAlignment="Center"/>
                                </Border>
                                <StackPanel Grid.Column="1" Margin="8,0,0,0" Spacing="2">
                                    <Button Content="▲" Width="36" Height="28" FontSize="12"
                                            Background="#34495E" Foreground="White" CornerRadius="4"
                                            Command="{Binding IncrementHeadlandPassesCommand}"/>
                                    <Button Content="▼" Width="36" Height="28" FontSize="12"
                                            Background="#34495E" Foreground="White" CornerRadius="4"
                                            Command="{Binding DecrementHeadlandPassesCommand}"/>
                                </StackPanel>
                            </Grid>
                        </StackPanel>
                    </Border>

                    <!-- Preview indicator -->
                    <Border Background="#1a1a1a" CornerRadius="8" Padding="12"
                            IsVisible="{Binding HeadlandPreviewLine, Converter={x:Static ObjectConverters.IsNotNull}}">
                        <StackPanel Orientation="Horizontal" HorizontalAlignment="Center" Spacing="8">
                            <Ellipse Width="12" Height="12" Fill="#F39C12"/>
                            <TextBlock Text="Preview shown on map" Foreground="#F39C12" FontSize="12"/>
                        </StackPanel>
                    </Border>

                    <!-- Current headland status -->
                    <Border Background="#1a1a1a" CornerRadius="8" Padding="12"
                            IsVisible="{Binding HasHeadland}">
                        <StackPanel Orientation="Horizontal" HorizontalAlignment="Center" Spacing="8">
                            <Ellipse Width="12" Height="12" Fill="#1ABC9C"/>
                            <TextBlock Text="Headland line active" Foreground="#1ABC9C" FontSize="12"/>
                        </StackPanel>
                    </Border>
                </StackPanel>

                <!-- Action Buttons -->
                <Grid ColumnDefinitions="*,*,*" Margin="0,8,0,0" IsVisible="{Binding HasBoundary}">
                    <Button Grid.Column="0" Content="Clear" Margin="0,0,4,0"
                            Command="{Binding ClearHeadlandCommand}"
                            Background="#E74C3C" Foreground="White"
                            HorizontalAlignment="Stretch" Height="44" FontSize="14"
                            HorizontalContentAlignment="Center" CornerRadius="6"
                            IsEnabled="{Binding HasHeadland}"/>
                    <Button Grid.Column="1" Content="Build" Margin="4,0,4,0"
                            Command="{Binding BuildHeadlandCommand}"
                            Background="#1ABC9C" Foreground="White"
                            HorizontalAlignment="Stretch" Height="44" FontSize="14"
                            HorizontalContentAlignment="Center" CornerRadius="6"/>
                    <Button Grid.Column="2" Content="Close" Margin="4,0,0,0"
                            Command="{Binding CloseHeadlandBuilderCommand}"
                            Background="#7F8C8D" Foreground="White"
                            HorizontalAlignment="Stretch" Height="44" FontSize="14"
                            HorizontalContentAlignment="Center" CornerRadius="6"/>
                </Grid>

                <!-- Close button for when no boundary -->
                <Button Content="Close" Margin="0,8,0,0"
                        Command="{Binding CloseHeadlandBuilderCommand}"
                        Background="#7F8C8D" Foreground="White"
                        HorizontalAlignment="Stretch" Height="44" FontSize="14"
                        HorizontalContentAlignment="Center" CornerRadius="6"
                        IsVisible="{Binding !HasBoundary}"/>
            </StackPanel>
        </Border>
    </Grid>
</UserControl>
